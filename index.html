<!doctype html>
<html lang="en">
<head>
  <!-- =========================================================
       LockHabit — Discipline Pays. Lock Your Money. Own Your Future.
       Fintech-grade landing (modern, secure, SEO, PWA, accessible)
       ========================================================= -->
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover"/>

  <title>LockHabit — Discipline Pays. Lock Your Money. Own Your Future.</title>
  <meta name="description" content="LockHabit is a behavioral savings vault. Hard-lock funds, earn 3% APR (prorated), access emergency credit-builder self-loans at 6% APR (credited back to you), and keep deposits safe with FDIC-backed partner banks."/>

  <!-- Canonical (update to your custom domain when live) -->
  <link rel="canonical" href="https://lockhabit.com/"/>

  <!-- Open Graph / Twitter -->
  <meta property="og:type" content="website"/>
  <meta property="og:title" content="LockHabit — Discipline Pays. Lock Your Money. Own Your Future."/>
  <meta property="og:description" content="Your money stays yours — hard-locked, FDIC-backed, growing at 3% APR. Emergency self-loans at 6% APR build credit and are credited back to your balance."/>
  <meta property="og:url" content="https://lockhabit.com/"/>
  <meta property="og:image" content="https://lockhabit.com/assets/og-image.svg"/>
  <meta name="twitter:card" content="summary_large_image"/>
  <meta name="twitter:title" content="LockHabit — Save on purpose"/>
  <meta name="twitter:description" content="Your money, locked safely and growing. Credit-builder access when life happens."/>
  <meta name="twitter:image" content="https://lockhabit.com/assets/og-image.svg"/>
  <meta name="theme-color" content="#6f7cff"/>

  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com"/>
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin/>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet"/>

  <!-- Icons & PWA -->
  <link rel="icon" href="/assets/favicon.svg" type="image/svg+xml">
  <link rel="alternate icon" href="/favicon.ico">
  <link rel="apple-touch-icon" href="/assets/icon-192.png">
  <link rel="manifest" href="/manifest.webmanifest">

  <!-- Plausible (privacy-first analytics) — set to your custom domain once live -->
  <script defer data-domain="lockhabit.com" src="https://plausible.io/js/script.js"></script>

  <!-- ========================= Styles ========================= -->
  <style>
    :root{
      /* Affirm-like palette + money-green */
      --brand:#6f7cff; --brand-2:#9c78ff; --brand-deep:#0b0e1a; --brand-soft:#f4f6ff;
      --green:#22c55e; --ink:#0f172a; --muted:#536179; --line:#e5e7f1; --panel:#ffffff;
      --radius-sm:12px; --radius:16px; --radius-lg:20px;
      --shadow-elev:0 18px 50px rgba(17,24,39,.10); --shadow-deep:0 40px 120px rgba(7,10,18,.45);
      --grad-hero:
        radial-gradient(1400px 750px at 50% -200px, rgba(111,124,255,.30) 0%, rgba(156,120,255,.20) 35%, transparent 60%),
        radial-gradient(1100px 700px at -10% 10%, rgba(156,120,255,.22) 0%, transparent 55%),
        radial-gradient(1100px 700px at 110% -20%, rgba(111,124,255,.18) 0%, transparent 60%),
        #f8f9ff;
      --grad-chip: linear-gradient(135deg, #e7ebff 0%, #f4f1ff 100%);
      --grad-cta: linear-gradient(135deg, var(--brand) 0%, var(--brand-2) 100%);
      --safe-bottom: env(safe-area-inset-bottom, 0px);
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; background:var(--brand-deep); color:var(--ink);
      font:16px/1.6 Inter,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;
      -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale;
      padding-bottom: calc(var(--safe-bottom));
      overflow-x:hidden;
    }

    /* Header */
    .header{position:sticky;top:0;z-index:50;background:rgba(255,255,255,.85);backdrop-filter:blur(10px);border-bottom:1px solid var(--line)}
    .wrap{max-width:1200px;margin:0 auto;padding:14px 22px;display:flex;align-items:center;justify-content:space-between}
    .brand{display:flex;align-items:center;gap:12px}
    .logo{width:36px;height:36px;flex:none}
    .word{font-weight:800;font-size:20px;color:#0e1a34}
    .nav a{color:#19253f;text-decoration:none;margin:0 12px;font-weight:600}
    .btn{appearance:none;border:1px solid var(--line);background:#fff;padding:12px 16px;border-radius:12px;font-weight:800;cursor:pointer;min-height:44px;-webkit-tap-highlight-color:transparent;touch-action:manipulation}
    .btn:hover{transform:translateY(-1px)}
    .btn.acc{background:var(--grad-cta);color:#fff;border-color:transparent;box-shadow:0 12px 30px rgba(111,124,255,.35)}
    .btn.ghost{background:transparent}

    /* Hero */
    .hero{background:var(--grad-hero);border-bottom:1px solid var(--line);padding:86px 22px 56px}
    .hero-grid{max-width:1200px;margin:0 auto;display:grid;grid-template-columns:1.05fr .95fr;gap:28px;align-items:center}
    h1{font-size:48px;line-height:1.08;margin:0 0 8px}
    .sub{color:#3a4a66;max-width:62ch}
    .chip{display:inline-flex;align-items:center;gap:10px;padding:8px 12px;border-radius:999px;background:var(--grad-chip);border:1px solid #dfe3ff;font-weight:700;color:#3a4a66}
    .chip b{color:var(--green)}
    .cta{display:flex;gap:12px;margin-top:18px;flex-wrap:wrap}
    .footnote{font-size:12px;color:#60708c;margin-top:8px}

    /* Mock card */
    .mock{background:#fff;border:1px solid var(--line);border-radius:20px;padding:18px;box-shadow:var(--shadow-elev);min-height:340px;position:relative;overflow:hidden}
    .mock .row{display:flex;align-items:center;justify-content:space-between}
    .badge-green{background:#eafff2;color:#0b3b22;border:1px solid #c8f5d9;padding:6px 10px;border-radius:999px;font-weight:800}
    .mini{font-size:12px;color:var(--muted)}
    .card{margin-top:12px;background:linear-gradient(180deg,#fff,#f9f9ff);border:1px solid var(--line);border-radius:14px;padding:14px}
    .bar{height:10px;border-radius:999px;background:#edf0f6;overflow:hidden;border:1px solid #e5e8f1}
    .fill{height:100%;width:0;background:linear-gradient(90deg,var(--green),var(--brand));transition:width .7s ease}
    .statgrid{display:grid;grid-template-columns:repeat(3,minmax(0,1fr));gap:12px;margin-top:12px}
    .stat{background:#fbfcff;border:1px solid var(--line);border-radius:12px;padding:12px}
    .k{font-size:12px;color:#5c6b86;letter-spacing:.04em;text-transform:uppercase}
    .v{font-weight:800;font-size:22px;color:#0b1230}

    /* Sections */
    section.s{max-width:1200px;margin:0 auto;padding:44px 22px}
    .section-title{font-size:30px;text-align:center;margin:0 0 18px;color:#f8f9ff}
    .panel{background:#fff;border:1px solid var(--line);border-radius:16px;padding:24px;box-shadow:var(--shadow-elev)}
    .cols3{display:grid;grid-template-columns:repeat(3,minmax(0,1fr));gap:14px}
    .cols2{display:grid;grid-template-columns:repeat(2,minmax(0,1fr));gap:14px}
    .plan{background:#fff;border:1px solid var(--line);border-radius:16px;padding:18px}
    .plan h3{margin:0 0 6px;color:#15213d}
    .plan ul{margin:8px 0 0;padding-left:18px;color:#3b4a67}
    .trustgrid{display:grid;grid-template-columns:repeat(3,minmax(0,1fr));gap:12px}
    .trust{background:#fff;border:1px solid var(--line);border-radius:16px;padding:16px}
    .trust b{color:#101828}

    /* Security ribbon */
    .ribbon{background:linear-gradient(135deg, rgba(111,124,255,.22), rgba(156,120,255,.22));border-top:1px solid var(--line);border-bottom:1px solid var(--line)}
    .ribwrap{max-width:1200px;margin:0 auto;padding:12px 22px;display:flex;gap:14px;align-items:center;justify-content:center;color:#e7ebff}
    .ribwrap .item{display:flex;align-items:center;gap:10px;background:rgba(255,255,255,.18);border:1px solid rgba(255,255,255,.25);padding:10px 12px;border-radius:999px}
    .ribwrap .item b{color:#fff}

    /* FAQ */
    details{background:#fff;border:1px solid var(--line);border-radius:14px;padding:14px}
    details+details{margin-top:10px}
    details summary{cursor:pointer;font-weight:700}
    details[open]{box-shadow:0 10px 24px rgba(16,24,40,.08)}

    /* Footer */
    footer{background:#fff;border-top:1px solid var(--line);color:#3a4a66}
    .foot{max-width:1200px;margin:0 auto;padding:24px 22px}
    .fine{background:#f6f7fc;border:1px solid var(--line);border-radius:12px;padding:12px;margin-top:12px;font-size:12px;color:#41506a}

    /* Modal */
    .overlay{position:fixed;inset:0;background:rgba(9,12,22,.55);backdrop-filter:blur(3px);display:none;align-items:center;justify-content:center;z-index:60}
    .modal{width:min(560px,92vw);background:#fff;border:1px solid var(--line);border-radius:16px;padding:18px;box-shadow:var(--shadow-deep)}
    .row{display:flex;align-items:center;justify-content:space-between}
    .x{border:0;background:transparent;font-size:20px;cursor:pointer;color:#64748b}
    .form{display:grid;gap:10px;margin-top:10px}
    input,select{padding:14px;border-radius:12px;border:1px solid #dbe0ea;font-size:16px}
    .note{font-size:12px;color:#60708c}
    .success{display:none;text-align:center;padding:18px}
    .check{font-size:42px}

    /* --- Mini Game (footer runner) --- */
    .miniwrap{position:fixed;left:0;right:0;bottom:0;z-index:40;pointer-events:none;padding-bottom:var(--safe-bottom)}
    .minibar{margin:0 auto;max-width:1200px;padding:6px 10px;display:flex;gap:8px;align-items:center;justify-content:flex-end}
    .minibar .pill{pointer-events:auto;display:inline-flex;align-items:center;gap:8px;background:#0e1330;color:#e5e7f1;border:1px solid #2b3150;border-radius:999px;padding:6px 10px;font-weight:700;cursor:pointer;min-height:36px}
    #gamePanel{pointer-events:auto;display:none;background:#0b0e1a;border-top:1px solid #2b3150}
    #gamePanel.open{display:block}
    #runnerCanvas{display:block;width:100%;max-width:1200px;height:120px;margin:0 auto;background:#0f172a}
    #gameInfo{max-width:1200px;margin:0 auto;color:#9fb2ff;font-size:12px;padding:6px 10px;display:flex;justify-content:space-between}

    /* Leaderboard + sharing UI */
    #gameUI{max-width:1200px;margin:0 auto;padding:6px 10px;display:flex;gap:12px;align-items:center;justify-content:space-between;color:#cbd5ff;font-size:12px;flex-wrap:wrap}
    #top10 li{background:#0e1330;border:1px solid #2b3150;border-radius:999px;padding:4px 8px;color:#e5e7f1}
    #playerName{padding:6px 8px;border-radius:10px;border:1px solid #2b3150;background:#0e1330;color:#e5e7f1}

    /* Responsive */
    @media (max-width:1000px){
      .hero-grid{grid-template-columns:1fr}
      h1{font-size:38px}
      .cols3,.cols2,.trustgrid{grid-template-columns:1fr}
    }
    @media (max-width:420px){
      h1{font-size:30px}
      .nav a{display:none}
      .btn{padding:12px 14px}
      .word{font-size:18px}
    }
  </style>
</head>
<body>
<!-- ========================= HEADER ========================= -->
<header class="header" role="banner">
  <div class="wrap">
    <div class="brand" aria-label="LockHabit">
      <svg class="logo" viewBox="0 0 120 120" aria-hidden="true">
        <defs>
          <linearGradient id="lg" x1="0" y1="0" x2="1" y2="1">
            <stop offset="0%" stop-color="#6f7cff"/>
            <stop offset="100%" stop-color="#9c78ff"/>
          </linearGradient>
        </defs>
        <rect x="12" y="22" width="96" height="80" rx="18" fill="url(#lg)"/>
        <path d="M40 50c0-16 12-28 28-28s28 12 28 28" fill="none" stroke="#ffffff" stroke-width="8" stroke-linecap="round"/>
        <path d="M40 90V58" stroke="#ffffff" stroke-width="10" stroke-linecap="round"/>
        <path d="M40 90h26" stroke="#e7ecf8" stroke-width="8" stroke-linecap="round"/>
      </svg>
      <div class="word">LockHabit</div>
    </div>
    <nav class="nav" role="navigation" aria-label="Main">
      <a href="#how">How it works</a>
      <a href="#plans">Plans</a>
      <a href="#security">Security</a>
      <button class="btn ghost" onclick="openModal()">Sign in</button>
      <button class="btn acc" onclick="openModal()">Get started</button>
    </nav>
  </div>
</header>

<!-- ========================= HERO ========================= -->
<section class="hero">
  <div class="hero-grid">
    <div>
      <div class="chip">Discipline Pays • <b>3% APR</b> • FDIC-Backed Custody</div>
      <h1>Discipline pays. Lock your money and own your future.</h1>
      <p class="sub">
        LockHabit transforms saving into progress. Hard-lock your funds, earn 3% APR (prorated), 
        and access 6% credit-builder emergency loans that pay you back.  
        Your deposits remain safe and FDIC-backed through regulated partner banks.
      </p>
      <div class="cta">
        <button class="btn acc" onclick="openModal()">Join the Waitlist</button>
        <button class="btn" onclick="document.getElementById('security').scrollIntoView({behavior:'smooth'})">See How It’s Protected</button>
      </div>
      <div class="footnote">Your money is never lent out. Your patience earns dividends.</div>
    </div>

    <aside class="mock" aria-live="polite">
      <div class="row">
        <div>
          <div class="mini">Savings Vault</div>
          <div style="font-weight:800;font-size:18px;color:#0f1a34">Goal Progress</div>
        </div>
        <span class="badge-green">On-time ↑ credit</span>
      </div>

      <div class="card" style="margin-top:10px">
        <div class="row">
          <div class="mini">Progress</div>
          <div class="mini" id="pval">0%</div>
        </div>
        <div class="bar"><div class="fill" id="pbar"></div></div>
      </div>

      <div class="statgrid">
        <div class="stat">
          <div class="k">Locked today</div>
          <div class="v">$1 250</div>
          <div class="k">Term 1–3 mo</div>
        </div>
        <div class="stat">
          <div class="k">Projected interest</div>
          <div class="v" id="intv">$0.00</div>
          <div class="k">at 3% APR</div>
        </div>
        <div class="stat">
          <div class="k">Emergency limit</div>
          <div class="v">$1 250</div>
          <div class="k">6% credit-builder loan</div>
        </div>
      </div>

      <div class="card" style="margin-top:12px">
        <div class="row">
          <div><b>Credit-builder loan</b><div class="mini">Bureau-reported payments</div></div>
          <div class="badge-green">Interest → back to your lock</div>
        </div>
      </div>
    </aside>
  </div>
</section>

<!-- ========================= SECURITY RIBBON ========================= -->
<div class="ribbon">
  <div class="ribwrap">
    <div class="item">🔒 <b>Hard-lock</b> (no early withdrawals except emergencies)</div>
    <div class="item">🏦 <b>FDIC-backed custody</b> via partner banks</div>
    <div class="item">📈 <b>Credit-builder</b> loans at 6% APR credited back</div>
    <div class="item">🧮 <b>Transparent</b> 3% APR • $3 / $2 / $1 unlock fees</div>
  </div>
</div>

<!-- ========================= HOW IT WORKS ========================= -->
<section id="how" class="s">
  <h2 class="section-title">How LockHabit Works</h2>
  <div class="panel">
    <div class="cols3">
      <div class="plan">
        <h3>1️⃣ Choose Your Lock</h3>
        <ul>
          <li>Select 1–3, 4–6, or 6–12 + months</li>
          <li>Optional auto-deposits</li>
          <li>Funds move into a secure vault</li>
        </ul>
      </div>
      <div class="plan">
        <h3>2️⃣ Grow Automatically</h3>
        <ul>
          <li>Earn <b>3% APR</b> (prorated)</li>
          <li>Your money is <b>never lent out</b></li>
          <li>View balance only when you choose</li>
        </ul>
      </div>
      <div class="plan">
        <h3>3️⃣ Unlock or Borrow</h3>
        <ul>
          <li>Unlock day: principal + interest − small flat fee</li>
          <li>Emergency? Borrow at <b>6% APR</b></li>
          <li>Loan interest is <b>credited back to you</b></li>
        </ul>
      </div>
    </div>
  </div>
</section>

<!-- ========================= PLANS ========================= -->
<section id="plans" class="s">
  <h2 class="section-title">Simple Transparent Plans</h2>
  <div class="cols3">
    <div class="plan">
      <h3>1–3 months</h3>
      <ul>
        <li><b>$3 flat</b> at unlock</li>
        <li><b>3% APR</b> (prorated)</li>
        <li>Fast goals</li>
      </ul>
      <div class="footnote">Emergency loan 6% APR credited back to your balance; reported to credit bureaus.</div>
    </div>
    <div class="plan">
      <h3>4–6 months</h3>
      <ul>
        <li><b>$2 flat</b> at unlock</li>
        <li><b>3% APR</b> (prorated)</li>
        <li>Balanced discipline</li>
      </ul>
      <div class="footnote">Hard-lock: non-emergency early break attempts incur a <b>5% fee</b>.</div>
    </div>
    <div class="plan">
      <h3>6–12 + months</h3>
      <ul>
        <li><b>$1 flat</b> at unlock</li>
        <li><b>3% APR</b> (prorated)</li>
        <li>Maximum growth</li>
      </ul>
      <div class="footnote">Deposits held with partner banks receive pass-through FDIC coverage up to legal limits.</div>
    </div>
  </div>
</section>

<!-- ========================= SECURITY ========================= -->
<section id="security" class="s">
  <h2 class="section-title">Your Money Stays Safe</h2>
  <div class="panel">
    <div class="trustgrid">
      <div class="trust">
        <b>FDIC-Backed Partner Banks</b>
        <p class="mini">Deposits are eligible for FDIC insurance up to legal limits per depositor when structured for pass-through coverage.</p>
      </div>
      <div class="trust">
        <b>Segregated and Never Lent</b>
        <p class="mini">Funds stay reserved for you — we do <b>not</b> lend out customer balances.</p>
      </div>
      <div class="trust">
        <b>Emergency Override</b>
        <p class="mini">Withdraw only for approved emergencies. Non-emergency breaks incur a <b>5% fee</b>.</p>
      </div>
      <div class="trust">
        <b>Credit-Builder Self-Loans</b>
        <p class="mini">Borrow against your own balance at <b>6% APR</b>; on-time payments are reported to credit bureaus to build credit.</p>
      </div>
      <div class="trust">
        <b>Interest That Pays You Back</b>
        <p class="mini">All loan interest is <b>credited back to your balance</b> when the loan is repaid.</p>
      </div>
      <div class="trust">
        <b>Transparent and Private</b>
        <p class="mini">No hidden fees or dark patterns — just secure, transparent finance that works for you.</p>
      </div>
    </div>
  </div>
</section>

<!-- ========================= FAQ ========================= -->
<section id="faq" class="s">
  <h2 class="section-title">FAQ</h2>
  <div class="panel">
    <details><summary>Is this a hard lock?</summary><p>Yes. Funds remain locked until the chosen unlock date. Early withdrawal is only permitted for approved emergencies; otherwise a 5% fee applies.</p></details>
    <details><summary>Do I earn interest while locked?</summary><p>Yes — balances earn 3% APR, prorated by time in lock. Rates subject to change with notice.</p></details>
    <details><summary>Are emergency loans credit-builder loans?</summary><p>Yes. Emergency self-loans are reported to major credit bureaus; on-time payments may help credit.</p></details>
    <details><summary>Is my money FDIC insured?</summary><p>Deposits are held at regulated partner banks eligible for FDIC coverage within legal limits.</p></details>
    <details><summary>Where does loan interest go?</summary><p>100% of the 6% APR interest is credited back to your balance once your loan is repaid in full.</p></details>
  </div>
</section>

<!-- ========================= FOOTER ========================= -->
<footer>
  <div class="foot">
    <div>© <span id="yr"></span> LockHabit — Discipline Made Simple.</div>
    <div class="fine">
      LockHabit is a financial technology company, not a bank. Banking services and deposit custody are provided by regulated partner banks. Funds are eligible for FDIC insurance up to applicable limits per depositor, per bank. 
      Early withdrawal is not permitted except for approved emergencies; non-emergency breaks incur a 5% fee. Emergency loans at 6% APR are reported to credit bureaus and interest is credited back to your locked balance. 
      APRs and fees subject to change with notice. Joining the waitlist does not guarantee account approval.
    </div>
    <div class="footnote" style="margin-top:8px">
      <a href="/terms.html">Terms</a> • <a href="/privacy.html">Privacy</a> • <a href="/security.html">Security</a>
    </div>
  </div>
</footer>

<!-- ========================= MINI GAME FOOTER ========================= -->
<div class="miniwrap">
  <div class="minibar">
    <button id="toggleGame" class="pill" aria-expanded="false" aria-controls="gamePanel">🎮 Mini Game (off)</button>
  </div>
  <div id="gamePanel">
    <canvas id="runnerCanvas" width="1200" height="120"></canvas>
    <div id="gameInfo">
      <span>Until launch: have fun — Space/↑ to jump • P pause • R reset</span>
      <span id="gameScore">Score: 0</span>
    </div>
    <div id="gameUI">
      <input id="playerName" placeholder="Enter name for leaderboard" maxlength="12"/>
      <ul id="top10"></ul>
      <div id="shareButtons"></div>
    </div>
  </div>
</div>

<!-- ========================= WAITLIST MODAL ========================= -->
<div id="overlay" class="overlay">
  <div class="modal">
    <div class="row">
      <h3 id="wl-title">Join the LockHabit Waitlist</h3>
      <button class="x" onclick="closeModal()">✕</button>
    </div>
    <p class="note">Be first in line when invites open. We’ll only email you about LockHabit.</p>
    <form id="wl-form" class="form">
      <input type="email" name="email" placeholder="Email address" required/>
      <input type="text" name="name" placeholder="Name (optional)"/>
      <select name="term">
        <option value="">Preferred lock term (optional)</option>
        <option value="1-3">1–3 months</option>
        <option value="4-6">4–6 months</option>
        <option value="6-12+">6–12 + months</option>
      </select>
      <button class="btn acc" type="submit">Join Waitlist</button>
      <div id="msg" class="note"></div>
    </form>
    <div id="ok" class="success">
      <div class="check">✅</div>
      <h3>Thanks — you’re on the list!</h3>
      <p class="note">Keep an eye on your inbox for updates.</p>
      <button class="btn acc" onclick="closeModal()">Back to Home</button>
    </div>
  </div>
</div>

<!-- ========================= SCRIPTS ========================= -->
<script>
  /* ===== Live year ===== */
  document.getElementById('yr').textContent = new Date().getFullYear();

  /* ===== Modal open/close (header CTAs hook into these) ===== */
  const overlay = document.getElementById('overlay');
  function openModal(){ overlay.style.display='flex'; document.body.style.overflow='hidden'; }
  function closeModal(){ overlay.style.display='none'; document.body.style.overflow=''; }
  window.openModal = openModal; window.closeModal = closeModal;

  /* ===== Progress dopamine loop (hero mock) ===== */
  (function(){
    const pbar = document.getElementById('pbar');
    const pval = document.getElementById('pval');
    const intv = document.getElementById('intv');
    if(!pbar || !pval || !intv) return;
    let prog = 0, bal = 1250;
    setInterval(()=>{
      prog = (prog + Math.random()*7) % 100;
      pbar.style.width = prog.toFixed(0) + '%';
      pval.textContent = prog.toFixed(0) + '%';
      const annual = 0.03 * bal; // 3% APR
      const proj = (annual * (prog/100)).toFixed(2);
      intv.textContent = `$${proj}`;
    }, 900);
  })();

  /* ===== Waitlist submit — Vercel API first, Formspree fallback ===== */
  (function(){
    const form = document.getElementById('wl-form');
    const msg  = document.getElementById('msg');
    const ok   = document.getElementById('ok');
    if(!form) return;

    form.addEventListener('submit', async (e)=>{
      e.preventDefault();
      msg.textContent = 'Submitting…';
      msg.style.color = '#60708c';

      const data = Object.fromEntries(new FormData(form).entries());
      const showOK = ()=>{ form.style.display='none'; ok.style.display='block'; };

      // 1) Try Vercel serverless API
      try{
        const res = await fetch('/api/waitlist', {
          method:'POST',
          headers:{'Content-Type':'application/json'},
          body:JSON.stringify(data)
        });
        const out = await res.json().catch(()=>({}));
        if(res.ok && out && (out.ok || out.id || out.inserted)){ showOK(); return; }
      }catch(_){}

      // 2) Fallback to Formspree
      try{
        const fs = await fetch('https://formspree.io/f/mrbywgpw', {
          method:'POST',
          headers:{'Accept':'application/json'},
          body:new FormData(form)
        });
        if(fs.ok){ showOK(); return; }
        msg.textContent = 'Network error. Please try again.'; msg.style.color = '#b42318';
      }catch(e){
        msg.textContent = 'Network error. Please try again.'; msg.style.color = '#b42318';
      }
    });
  })();

  /* ============================================================
     MINI RUNNER (footer) + Global Top-10 + Sharing
     ============================================================ */
  (function(){
    const prefersReduced = window.matchMedia('(prefers-reduced-motion: reduce)').matches;
    const toggleBtn = document.getElementById('toggleGame');
    const panel     = document.getElementById('gamePanel');
    const cvs       = document.getElementById('runnerCanvas');
    const scoreEl   = document.getElementById('gameScore');
    if(!toggleBtn || !panel || !cvs || !scoreEl) return;

    const ctx = cvs.getContext('2d');
    let W = cvs.width, H = cvs.height;

    // Runner state
    let running = false, paused = false, t0 = 0, score = 0, raf;
    const G = 0.9, ground = H - 18;
    const player = { x: 40, y: ground, vy: 0, w: 14, h: 14, onGround: true };
    let obs = []; let spawn = 0;

    // Helpers
    function reset(){ score = 0; obs = []; spawn = 0; player.y = ground; player.vy = 0; player.onGround = true; paused = false; }
    function jump(){ if(!running || paused) return; if(player.onGround){ player.vy = -12; player.onGround = false; } }
    function drawBg(){ ctx.fillStyle = '#0f172a'; ctx.fillRect(0,0,W,H); ctx.strokeStyle = '#26304a'; ctx.lineWidth = 2; ctx.beginPath(); ctx.moveTo(0, ground+8); ctx.lineTo(W, ground+8); ctx.stroke(); }
    function drawPlayer(){ ctx.fillStyle = '#e6eaff'; ctx.fillRect(player.x, player.y - player.h, player.w, player.h); }
    function addObstacle(){ const h = 10 + Math.floor(Math.random()*18); const w = 8 + Math.floor(Math.random()*10); const speed = 4 + Math.random()*2; obs.push({ x: W + 10, y: ground, w, h, v: speed }); }
    function drawObstacles(){ ctx.fillStyle = '#91a1ff'; for(const o of obs){ ctx.fillRect(o.x, o.y - o.h, o.w, o.h); } }
    function collide(a,b){ return !(a.x + a.w < b.x || a.x > b.x + b.w || a.y < b.y - b.h || a.y - a.h > b.y); }

    // Resize for DPR + responsiveness
    function resize(){
      const dpr = Math.max(1, Math.min(2, window.devicePixelRatio || 1));
      const cssW = Math.min(1200, document.documentElement.clientWidth);
      cvs.style.width = cssW + 'px';
      cvs.width = cssW * dpr; cvs.height = 120 * dpr; ctx.setTransform(dpr,0,0,dpr,0,0);
      W = cssW;
    }
    window.addEventListener('resize', resize, {passive:true});
    resize();

    // Main loop
    function step(ts){
      if(!running){ return; }
      if(prefersReduced){ paused = true; }
      if(paused){ raf = requestAnimationFrame(step); return; }
      if(!t0) t0 = ts; const dt = Math.min(32, ts - t0); t0 = ts;

      // Physics
      player.vy += G; player.y += player.vy;
      if(player.y >= ground){ player.y = ground; player.vy = 0; player.onGround = true; }

      // Obstacles
      spawn -= dt; if(spawn <= 0){ addObstacle(); spawn = 800 + Math.random()*900; }
      for(const o of obs){ o.x -= o.v; } obs = obs.filter(o => o.x + o.w > -10);

      // Collisions
      for(const o of obs){
        if(collide({x:player.x,y:player.y,w:player.w,h:player.h},{x:o.x,y:o.y,w:o.w,h:o.h})){
          // snapshot score and show quick flash
          window.__setGameScore?.(score);
          ctx.save(); ctx.fillStyle = 'rgba(255,0,70,.18)'; ctx.fillRect(0,0,W,H); ctx.restore();
          reset();
          break;
        }
      }

      // Score update (also feed to share/leaderboard)
      score += Math.floor(dt/10);
      window.__setGameScore?.(score);
      scoreEl.textContent = 'Score: ' + score;

      // Draw
      drawBg(); drawObstacles(); drawPlayer();
      raf = requestAnimationFrame(step);
    }

    function start(){ if(running) return; running = true; paused = false; t0 = 0; raf = requestAnimationFrame(step); }
    function stop(){ running = false; paused = false; cancelAnimationFrame(raf); }

    // Keyboard controls
    window.addEventListener('keydown', (e)=>{
      if(panel.classList.contains('open')){
        if(e.code === 'Space' || e.code === 'ArrowUp'){ e.preventDefault(); jump(); }
        if(e.code === 'KeyR'){ reset(); }
        if(e.code === 'KeyP'){ paused = !paused; }
      }
    });

    // Touch to jump (mobile)
    cvs.addEventListener('touchstart', (e)=>{
      if(panel.classList.contains('open')){
        e.preventDefault();
        jump();
      }
    }, {passive:false});

    // Open/Close panel
    toggleBtn.addEventListener('click', ()=>{
      const open = panel.classList.toggle('open');
      toggleBtn.setAttribute('aria-expanded', String(open));
      toggleBtn.textContent = open ? '🎮 Mini Game (on)' : '🎮 Mini Game (off)';
      if(open){ start(); fetchTop10(); } else { stop(); }
    });

    document.addEventListener('visibilitychange', ()=>{ if(document.hidden) paused = true; });
    const mo = new MutationObserver(()=>{ if(overlay && overlay.style.display === 'flex'){ paused = true; } });
    if(overlay) mo.observe(overlay, {attributes:true, attributeFilter:['style']});

    /* ===== Leaderboard + Sharing ===== */
    const api     = '/api/highscores';          // requires your api/highscores.js (Supabase)
    const nameInp = document.getElementById('playerName');
    const topEl   = document.getElementById('top10');
    const shareBox= document.getElementById('shareButtons');

    // Build share + submit UI
    function buildShareUI(){
      if(!shareBox) return;
      shareBox.innerHTML = '';
      const makeBtn = (label, net)=> {
        const b = document.createElement('button');
        b.className = 'pill';
        b.style.background = '#162048';
        b.style.borderColor = '#2b3150';
        b.textContent = label;
        b.addEventListener('click', ()=>shareTo(net));
        return b;
      };
      const submit = makeBtn('⬆️ Submit score', 'submit');
      shareBox.appendChild(submit);
      shareBox.appendChild(makeBtn('X', 'twitter'));
      shareBox.appendChild(makeBtn('Facebook', 'facebook'));
      shareBox.appendChild(makeBtn('LinkedIn', 'linkedin'));
      shareBox.appendChild(makeBtn('WhatsApp', 'whatsapp'));
      shareBox.appendChild(makeBtn('Reddit', 'reddit'));
      const tip = document.createElement('span');
      tip.style.marginLeft = '8px';
      tip.style.color = '#9fb2ff';
      tip.textContent = 'Thanks for playing — once we launch, your true patience will be rewarded.';
      shareBox.appendChild(tip);
    }
    buildShareUI();

    // Persisted name
    const savedName = (localStorage.getItem('lh_name') || '').slice(0,20);
    if(nameInp){ nameInp.value = savedName; nameInp.addEventListener('change', ()=>localStorage.setItem('lh_name', nameInp.value.trim().slice(0,20))); }

    let lastScore = 0;
    window.__setGameScore = (n)=>{ lastScore = n|0; scoreEl.textContent = 'Score: ' + lastScore; };

    async function fetchTop10(){
      try{
        const r = await fetch(api);
        const j = await r.json();
        if(j.ok && Array.isArray(j.top10)){
          topEl.innerHTML = '';
          j.top10.forEach((row, i)=>{
            const li = document.createElement('li');
            li.textContent = `${i+1}. ${(row.name||'anon')} — ${row.score}`;
            topEl.appendChild(li);
          });
        }
      }catch(_){}
    }

    async function submitScore(){
      const score = lastScore|0;
      if(score <= 0){ alert('Play a bit first!'); return; }
      const name = (nameInp?.value || localStorage.getItem('lh_name') || 'anon').toString().trim().slice(0,20) || 'anon';
      localStorage.setItem('lh_name', name);
      try{
        const r = await fetch(api, {
          method:'POST',
          headers:{'Content-Type':'application/json'},
          body:JSON.stringify({ name, score })
        });
        const j = await r.json();
        if(j.ok){ await fetchTop10(); alert('Submitted! Check the Top-10.'); }
        else { alert('Could not submit: ' + (j.error||'unknown error')); }
      }catch(e){ alert('Network error while submitting.'); }
    }

    function shareTo(net){
      if(net === 'submit'){ submitScore(); return; }
      const score = lastScore|0;
      const url = new URL(location.href);
      url.searchParams.set('score', String(score));
      url.searchParams.set('utm_source','game');
      const text = `I scored ${score} in the LockHabit mini-runner while I wait for launch. Join the waitlist!`;
      // Native share first
      if(navigator.share && (net === 'native')){
        navigator.share({ title:'LockHabit', text, url:url.toString() }).catch(()=>{});
        return;
      }
      let shareURL = '';
      switch(net){
        case 'twitter': {
          const u = new URL('https://twitter.com/intent/tweet');
          u.searchParams.set('text', text);
          u.searchParams.set('url', url.toString());
          shareURL = u.toString(); break;
        }
        case 'facebook': {
          const u = new URL('https://www.facebook.com/sharer/sharer.php');
          u.searchParams.set('u', url.toString());
          shareURL = u.toString(); break;
        }
        case 'linkedin': {
          const u = new URL('https://www.linkedin.com/sharing/share-offsite/');
          u.searchParams.set('url', url.toString());
          shareURL = u.toString(); break;
        }
        case 'whatsapp': {
          const u = new URL('https://api.whatsapp.com/send');
          u.searchParams.set('text', `${text} ${url.toString()}`);
          shareURL = u.toString(); break;
        }
        case 'reddit': {
          const u = new URL('https://www.reddit.com/submit');
          u.searchParams.set('title', text);
          u.searchParams.set('url', url.toString());
          shareURL = u.toString(); break;
        }
        default: return;
      }
      window.open(shareURL, '_blank', 'noopener,noreferrer');
    }

  })();

  /* ===== PWA Service Worker registration ===== */
  if('serviceWorker' in navigator){
    window.addEventListener('load', ()=> {
      navigator.serviceWorker.register('/sw.js').then(
        ()=>console.log('✅ Service Worker registered'),
        err=>console.error('❌ SW registration failed:', err)
      );
    });
  }
</script>
</body>
</html>