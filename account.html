<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Your LockHabit Account (Pre-launch)</title>
  <meta name="description" content="Your pre-launch LockHabit account status and plan."/>
  <link rel="preconnect" href="https://fonts.googleapis.com"/>
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin/>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet"/>
  <style>
    :root{--bg:#0e1330;--panel:#fff;--ink:#0f172a;--muted:#5b6a86;--brand:#6f7cff;--brand2:#9c78ff;--line:#e5e7f1;--green:#22c55e}
    *{box-sizing:border-box}
    body{margin:0;font:16px/1.6 Inter,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;background:var(--bg);color:var(--ink)}
    .wrap{max-width:900px;margin:0 auto;padding:24px 16px}
    header a{color:#e7ebff;text-decoration:none;font-weight:800}
    .grid{display:grid;grid-template-columns:1fr 1fr;gap:14px}
    .card{background:#fff;border:1px solid var(--line);border-radius:18px;padding:18px}
    h1,h2{margin:0 0 6px}
    .muted{color:var(--muted)}
    input,select{width:100%;padding:12px;border:1px solid #dbe0ea;border-radius:12px;font-size:16px}
    .btn{display:inline-block;border:1px solid var(--line);background:#fff;padding:12px 16px;border-radius:12px;font-weight:800;cursor:pointer}
    .btn.acc{background:linear-gradient(135deg,var(--brand),var(--brand2));color:#fff;border:0}
    .ok{background:#eafff2;color:#0b3b22;border:1px solid #c8f5d9;border-radius:10px;padding:8px 10px;font-weight:700;display:inline-block}
    .note{font-size:12px;color:var(--muted);margin-top:8px}
    @media (max-width:820px){ .grid{grid-template-columns:1fr} }
  </style>
</head>
<body>
  <header class="wrap">
    <a href="index.html">‚Üê Home</a>
  </header>

  <div class="wrap">
    <div class="card">
      <h1>Welcome, <span id="name">there</span> üëã</h1>
      <p class="muted">Status: <b id="status">Pre-launch (waitlist)</b>. When we open, your account will migrate automatically.</p>
    </div>

    <div class="grid" style="margin-top:12px">
      <div class="card">
        <h2>Set your plan</h2>
        <p class="muted">We‚Äôll send this straight to the demo so you can see how it grows.</p>
        <label class="muted">Initial deposit</label>
        <input id="init" type="number" value="200"/>
        <div style="height:8px"></div>
        <label class="muted">Recurring deposit</label>
        <input id="rec" type="number" value="200"/>
        <div style="height:8px"></div>
        <label class="muted">Frequency</label>
        <select id="freq">
          <option value="biweekly" selected>Bi-weekly</option>
          <option value="weekly">Weekly</option>
          <option value="monthly">Monthly</option>
        </select>
        <div style="height:8px"></div>
        <label class="muted">Term (months)</label>
        <select id="term">
          <option value="12" selected>12 months</option>
          <option value="6">6 months</option>
          <option value="18">18 months</option>
          <option value="24">24 months</option>
        </select>

        <div style="height:12px"></div>
        <button id="toDemo" class="btn acc">Open demo with my plan</button>
        <div class="note">We pass your plan via localStorage for a smooth handoff.</div>
      </div>

      <div class="card">
        <h2>Optional: Pre-funding pledge</h2>
        <p class="muted">Non-binding. Helps us forecast launch day capacity. We‚Äôll confirm with you by email before anything moves.</p>
        <label class="muted">Planned first transfer</label>
        <input id="pledge" type="number" min="0" value="200"/>
        <div style="height:12px"></div>
        <button id="savePledge" class="btn">Save pledge</button>
        <span id="ok" class="ok" style="display:none;margin-left:8px">Saved</span>
        <div class="note">You can change this anytime.</div>
      </div>
    </div>
  </div>

  <script>
    // Load session
    const sess = JSON.parse(localStorage.getItem('lh_session')||'{}');
    const users= JSON.parse(localStorage.getItem('lh_users')||'{}');
    const user = users[sess.email] || sess || {};
    document.getElementById('name').textContent = user.name || 'there';

    // Plan ‚Üí demo
    document.getElementById('toDemo').addEventListener('click', ()=>{
      const plan = {
        init: Number(document.getElementById('init').value||0),
        rec:  Number(document.getElementById('rec').value||0),
        freq: document.getElementById('freq').value,
        term: Number(document.getElementById('term').value||12)
      };
      localStorage.setItem('lh_plan', JSON.stringify(plan));
      location.href = 'demo.html';
    });

    // Pledge (store + POST to stub for later analytics)
    document.getElementById('savePledge').addEventListener('click', async ()=>{
      const amt = Math.max(0, Number(document.getElementById('pledge').value||0));
      const ok  = document.getElementById('ok');
      const payload = { email: user.email || '', name: user.name || '', pledge: amt, ts: Date.now() };

      try{
        // Try API stub (ok if it fails in this phase)
        await fetch('/api/pledge', { method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify(payload) });
      }catch(_){}
      localStorage.setItem('lh_pledge', JSON.stringify(payload));
      ok.style.display='inline-block';
      setTimeout(()=>ok.style.display='none', 1600);
    });
  </script>
</body>
</html>