<!doctype html>
<html lang="en">
<head>
  <!-- =========================================================
       LockHabit — Salary & Take-Home Pay Calculator (2025 est.)
       Clean layout • Tesla-like minimal • Accordions • Fixed inputs
       ========================================================= -->
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover"/>
  <title>Salary & Take-Home Pay Calculator (2025 est.) | LockHabit</title>
  <meta name="description" content="Estimate 2025 take-home pay, add monthly expenses, and build a LockHabit plan with tiered APRs and compounding. Compare vs a high-interest savings account you choose."/>
  <link rel="canonical" href="https://lockhabit.com/calculator.html"/>

  <!-- Social -->
  <meta property="og:type" content="website"/>
  <meta property="og:title" content="Salary & Take-Home Pay Calculator (2025 est.) — LockHabit"/>
  <meta property="og:description" content="Clean, fast, accurate estimates with tiered APRs and compounding. Includes a high-interest savings comparison."/>
  <meta property="og:url" content="https://lockhabit.com/calculator.html"/>
  <meta property="og:image" content="https://lockhabit.com/assets/og-image.png"/>
  <meta name="twitter:card" content="summary_large_image"/>
  <meta name="theme-color" content="#6f7cff"/>

  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com"/>
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin/>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet"/>

  <!-- Icons/PWA (paths may differ in your repo; safe to leave as-is) -->
  <link rel="icon" href="/assets/favicon.svg" type="image/svg+xml">
  <link rel="alternate icon" href="/favicon.ico">
  <link rel="apple-touch-icon" href="/assets/icon-192.png">
  <link rel="manifest" href="/manifest.webmanifest">

  <style>
    :root{
      --brand:#6f7cff; --brand2:#9c78ff; --accent:#9fb2ff;
      --ink:#0f172a; --ink2:#15213d; --muted:#536179; --muted2:#3a4a66;
      --line:#e5e7f1; --panel:#ffffff; --surface:#fbfcff;
      --green:#22c55e; --danger:#b42318; --bg:#0e1330;
      --radius:16px; --radius-lg:22px;
      --shadow:0 18px 50px rgba(17,24,39,.10);
      --grad:
        radial-gradient(1400px 700px at 50% -200px, rgba(111,124,255,.25), transparent 60%),
        radial-gradient(900px 600px at -10% 10%, rgba(156,120,255,.18), transparent 55%),
        #f6f8ff;
    }
    *{box-sizing:border-box}
    body{margin:0;background:var(--bg);color:var(--ink);
         font:16px/1.6 Inter,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;}

    /* Header */
    header.hdr{position:sticky;top:0;z-index:50;background:rgba(255,255,255,.92);
           backdrop-filter:blur(10px);border-bottom:1px solid var(--line);transition:box-shadow .2s ease}
    header.hdr.small{box-shadow:0 6px 18px rgba(17,24,39,.08)}
    .wrap{max-width:1100px;margin:0 auto;padding:14px 22px}
    .row{display:flex;align-items:center;justify-content:space-between;gap:12px}
    .brand{display:flex;align-items:center;gap:10px;cursor:pointer}
    .logo{width:32px;height:32px}
    .word{font-weight:800;color:#0e1a34}
    nav a{color:#19253f;text-decoration:none;font-weight:600;margin-left:14px}

    /* Hero */
    .hero{background:var(--grad);border-bottom:1px solid var(--line);padding:40px 0}
    h1{margin:0 0 8px;font-size:34px}
    .sub{margin:0;color:#3a4a66;max-width:70ch}

    /* Panels & form */
    main.wrap{padding-top:18px}
    .panel{background:#fff;border:1px solid var(--line);border-radius:16px;padding:16px;box-shadow:var(--shadow)}
    .k{font-size:12px;text-transform:uppercase;letter-spacing:.04em;color:#5b6a86;font-weight:700}
    .v{font-weight:800;color:#0f1a34}
    label.k{display:block;margin:8px 0 6px}

    /* Unified controls (fixes height alignment) */
    .ctrl{width:100%;height:44px;padding:10px 12px;border:1px solid #dbe0ea;border-radius:12px;font-size:16px;background:#fff;line-height:22px;appearance:none;-webkit-appearance:none;-moz-appearance:none}
    .ctrl[type="number"]{-moz-appearance:textfield}
    .ctrl::-webkit-outer-spin-button,.ctrl::-webkit-inner-spin-button{-webkit-appearance:none;margin:0}
    .select-wrap{position:relative}
    .select-wrap:after{content:"";position:absolute;right:12px;top:50%;width:0;height:0;border-left:6px solid transparent;border-right:6px solid transparent;border-top:6px solid #7a869e;transform:translateY(-50%)}

    .two{display:grid;grid-template-columns:1fr 1fr;gap:10px}
    .three{display:grid;grid-template-columns:1fr 1fr 1fr;gap:10px}
    .note{font-size:12px;color:#60708c}
    .tip{color:#0b3b22;background:#eafff2;border:1px solid #c8f5d9;border-radius:10px;padding:8px 10px;font-weight:700;display:inline-block}
    .btn{appearance:none;border:1px solid var(--line);background:#fff;padding:12px 16px;border-radius:12px;font-weight:800;cursor:pointer}
    .btn.acc{background:linear-gradient(135deg,var(--brand),var(--brand2));color:#fff;border:0;box-shadow:0 10px 24px rgba(111,124,255,.35)}
    .btn.ghost{background:transparent}
    .actions{display:flex;gap:10px;flex-wrap:wrap;margin-top:12px}
    .bar{height:10px;border-radius:999px;background:#edf0f6;overflow:hidden;border:1px solid #e5e8f1}
    .fill{height:100%;width:0;background:linear-gradient(90deg,var(--green),var(--brand));transition:width .6s ease}

    /* Accordions */
    details.acc{border:1px solid var(--line);border-radius:14px;background:#fff;margin-top:10px;overflow:hidden}
    details.acc>summary{list-style:none;cursor:pointer;padding:14px 16px;font-weight:800;color:#101828;display:flex;align-items:center;justify-content:space-between;gap:10px}
    details.acc>summary::-webkit-details-marker{display:none}
    .acc-body{padding:0 16px 16px}
    .hint{color:#5d6a86;font-weight:600;font-size:13px}

    /* Grid layout */
    .grid{display:grid;grid-template-columns:1.15fr .85fr;gap:16px;margin-top:16px}
    @media (max-width:980px){ .grid{grid-template-columns:1fr} }

    /* Tables */
    .table{width:100%;border-collapse:collapse;margin-top:8px}
    .table th,.table td{padding:10px 8px;border-bottom:1px solid #eef1f7;text-align:right}
    .table th:first-child,.table td:first-child{text-align:left}

    footer{margin:22px 0;color:#cbd5e1;font-size:12px;text-align:center}
  </style>
</head>
<body>
  <!-- Header -->
  <header class="hdr" id="hdr">
    <div class="wrap row">
      <div class="brand" id="brandTop" title="Back to top">
        <svg class="logo" viewBox="0 0 120 120" aria-hidden="true">
          <defs><linearGradient id="lg" x1="0" y1="0" x2="1" y2="1"><stop offset="0%" stop-color="#6f7cff"/><stop offset="100%" stop-color="#9c78ff"/></linearGradient></defs>
          <rect x="12" y="22" width="96" height="80" rx="18" fill="url(#lg)"/>
          <path d="M40 50c0-16 12-28 28-28s28 12 28 28" fill="none" stroke="#ffffff" stroke-width="8" stroke-linecap="round"/>
          <path d="M40 90V58" stroke="#ffffff" stroke-width="10" stroke-linecap="round"/>
          <path d="M40 90h26" stroke="#e7ecf8" stroke-width="8" stroke-linecap="round"/>
        </svg>
        <div class="word">LockHabit</div>
      </div>
      <nav class="row" style="gap:8px">
        <a href="/index.html">Home</a>
        <a aria-current="page" class="word" style="font-weight:700;font-size:16px;color:#1f2b45">Calculator</a>
      </nav>
    </div>
  </header>

  <!-- Hero -->
  <section class="hero">
    <div class="wrap">
      <h1>Salary & Take-Home Pay Calculator (2025 est.)</h1>
      <p class="sub">Start with your income and state, add expenses if you want, then build a LockHabit plan with tiered APRs and compounding. Compare it to a high-interest savings account you choose.</p>
    </div>
  </section>

  <!-- Main -->
  <main class="wrap">
    <div class="grid">
      <!-- LEFT: Inputs -->
      <section class="panel" aria-labelledby="inputs-title">
        <h2 id="inputs-title" style="margin:0 0 8px">Your details</h2>

        <!-- Income & State (top) -->
        <div class="two">
          <div>
            <label class="k">Pay frequency</label>
            <div class="select-wrap">
              <select id="freq" class="ctrl">
                <option value="weekly">Weekly</option>
                <option value="biweekly" selected>Bi-weekly</option>
                <option value="monthly">Monthly</option>
                <option value="annual">Annual</option>
              </select>
            </div>
          </div>
          <div>
            <label class="k">Income (gross)</label>
            <input id="income" class="ctrl" type="number" min="0" value="2000" inputmode="decimal"/>
          </div>
        </div>

        <div class="two" style="margin-top:8px">
          <div>
            <label class="k">Filing status</label>
            <div class="select-wrap">
              <select id="status" class="ctrl">
                <option value="single" selected>Single</option>
                <option value="married">Married filing jointly</option>
              </select>
            </div>
          </div>
          <div>
            <label class="k">State</label>
            <div class="select-wrap"><select id="state" class="ctrl"></select></div>
          </div>
        </div>

        <!-- Accordion: Advanced tax & Expenses -->
        <details class="acc" style="margin-top:12px">
          <summary>Advanced tax options</summary>
          <div class="acc-body">
            <div class="two" style="margin-top:6px">
              <div>
                <label class="k">Pre-tax contribution % (401k/HSA)</label>
                <input id="pretaxPct" class="ctrl" type="number" min="0" max="50" step="0.5" value="0"/>
              </div>
              <div class="two" style="gap:8px;align-items:center">
                <div style="display:flex;align-items:center;gap:8px;margin-top:22px">
                  <input id="useCustomState" type="checkbox"/>
                  <label for="useCustomState" class="k" style="text-transform:none;letter-spacing:0">Use custom state rate</label>
                </div>
                <div>
                  <label class="k">Custom state tax %</label>
                  <input id="stateRate" class="ctrl" type="number" min="0" max="20" step="0.1" value="4" disabled/>
                </div>
              </div>
            </div>
            <div style="margin-top:8px;display:flex;align-items:center;gap:10px">
              <input id="exempt" type="checkbox"/>
              <label for="exempt" class="k" style="text-transform:none;letter-spacing:0">Tax-exempt (federal & state)</label>
            </div>
          </div>
        </details>

        <details class="acc" open style="margin-top:10px">
          <summary>Monthly expenses (optional)</summary>
          <div class="acc-body">
            <div class="three" style="margin-top:6px">
              <div>
                <label class="k">Housing (rent/mortgage)</label>
                <input id="expHousing" class="ctrl" type="number" min="0" value="1200"/>
              </div>
              <div>
                <label class="k">Utilities & phone</label>
                <input id="expUtils" class="ctrl" type="number" min="0" value="250"/>
              </div>
              <div>
                <label class="k">Debt payments</label>
                <input id="expDebt" class="ctrl" type="number" min="0" value="300"/>
              </div>
            </div>
            <div class="two" style="margin-top:8px">
              <div>
                <label class="k">Other essentials</label>
                <input id="expOther" class="ctrl" type="number" min="0" value="350"/>
              </div>
              <div style="display:flex;align-items:flex-end">
                <span class="note">Tip: Start with 20–30% of your leftover each month as your recurring deposit.</span>
              </div>
            </div>
          </div>
        </details>

        <!-- Your LockHabit plan (accordion) -->
        <details class="acc" id="lhPlanAcc" open>
          <summary>Your LockHabit plan <span class="hint" id="planHint"></span></summary>
          <div class="acc-body">
            <div class="two">
              <div>
                <label class="k">Contribution frequency</label>
                <div class="select-wrap">
                  <select id="lockFreq" class="ctrl">
                    <option value="weekly">Weekly</option>
                    <option value="biweekly" selected>Bi-weekly</option>
                    <option value="monthly">Monthly</option>
                  </select>
                </div>
              </div>
              <div>
                <label class="k">Initial deposit</label>
                <input id="initDeposit" class="ctrl" type="number" min="0" value="0"/>
              </div>
            </div>

            <div class="two" style="margin-top:8px">
              <div>
                <label class="k">Recurring deposit</label>
                <input id="recDeposit" class="ctrl" type="number" min="0" value="200"/>
              </div>
              <div>
                <label class="k">Lock term (APR)</label>
                <div class="select-wrap">
                  <select id="lockTerm" class="ctrl">
                    <option value="3">3 months (2.0%)</option>
                    <option value="6">6 months (2.5%)</option>
                    <option value="12" selected>12 months (3.0%)</option>
                    <option value="24">24+ months (3.5%)</option>
                    <option value="custom">Custom…</option>
                  </select>
                </div>
              </div>
            </div>

            <div class="two" id="customTermRow" style="margin-top:8px; display:none">
              <div>
                <label class="k">Custom months (1–120)</label>
                <input id="customMonths" class="ctrl" type="number" min="1" max="120" step="1" value="18"/>
              </div>
              <div>
                <label class="k">APR mode</label>
                <div class="select-wrap">
                  <select id="aprMode" class="ctrl">
                    <option value="auto" selected>Auto (term tiers)</option>
                    <option value="fixed">Fixed 3% APR</option>
                  </select>
                </div>
              </div>
            </div>
          </div>
        </details>

        <!-- HYSA input (accordion) -->
        <details class="acc" id="hysaAcc">
          <summary>Compare to high-interest account <span class="hint" id="hysaHint"></span></summary>
          <div class="acc-body">
            <div class="two">
              <div>
                <label class="k">High-interest account APR (%)</label>
                <input id="hysaApr" class="ctrl" type="number" min="0" max="15" step="0.1" value="4.5"/>
              </div>
              <div>
                <label class="k">Compounding</label>
                <div class="select-wrap">
                  <select id="hysaComp" class="ctrl">
                    <option value="monthly" selected>Monthly</option>
                    <option value="daily">Daily (approx.)</option>
                  </select>
                </div>
              </div>
            </div>
            <div class="actions">
              <button id="recalc" class="btn">Recalculate</button>
              <button id="ctaWaitlist" class="btn acc" type="button">Join waitlist</button>
            </div>
            <p class="note" style="margin-top:10px">
              2025 taxes are estimates. State rates are simplified effective rates by state; your actual withholding may differ (W-4, credits, local taxes, benefits).
            </p>
          </div>
        </details>
      </section>

      <!-- RIGHT: Output -->
      <aside class="panel" aria-labelledby="out-title">
        <h2 id="out-title" style="margin:0 0 8px">Your snapshot</h2>

        <div class="two">
          <div>
            <div class="k">Annual gross</div>
            <div class="v" id="outGross">$0</div>
          </div>
          <div>
            <div class="k">Pre-tax contrib.</div>
            <div class="v" id="outPretax">$0</div>
          </div>
        </div>

        <div class="two" style="margin-top:8px">
          <div>
            <div class="k">Est. federal income tax</div>
            <div class="v" id="outFed">$0</div>
          </div>
          <div>
            <div class="k">Est. state income tax</div>
            <div class="v" id="outState">$0</div>
          </div>
        </div>

        <div class="two" style="margin-top:8px">
          <div>
            <div class="k">Payroll taxes (SS + Medicare)</div>
            <div class="v" id="outFica">$0</div>
          </div>
          <div>
            <div class="k">Annual net (est.)</div>
            <div class="v" id="outNet">$0</div>
          </div>
        </div>

        <div class="panel" style="margin-top:10px">
          <div class="k">Net by pay period</div>
          <table class="table">
            <tbody>
              <tr><td>Weekly</td><td id="netWeekly">$0</td></tr>
              <tr><td>Bi-weekly</td><td id="netBiweekly">$0</td></tr>
              <tr><td>Monthly</td><td id="netMonthly">$0</td></tr>
            </tbody>
          </table>
        </div>

        <div class="panel" style="margin-top:10px">
          <div class="k">Expenses & safe amount</div>
          <table class="table">
            <tbody>
              <tr><td>Monthly expenses</td><td id="outExp">$0</td></tr>
              <tr><td>Net monthly</td><td id="outNetMonthly">$0</td></tr>
              <tr><td><b>Safe to lock (suggested)</b></td><td id="outSafe" style="font-weight:800">$0</td></tr>
            </tbody>
          </table>
          <div class="bar" style="margin-top:8px"><div id="safeFill" class="fill"></div></div>
          <div class="note" style="margin-top:6px">We suggest ~20–30% of your leftover each month to start. Adjust to your comfort.</div>
        </div>

        <!-- LockHabit projection (accordion) -->
        <details class="acc" id="projAcc" style="margin-top:10px" open>
          <summary>LockHabit projection (compounding) <span class="hint" id="projHint"></span></summary>
          <div class="acc-body">
            <table class="table">
              <tbody>
                <tr><td>APR used</td><td id="aprUsed">3.00%</td></tr>
                <tr><td>Projected interest</td><td id="projInterest">$0</td></tr>
                <tr><td><b>Projected balance @ maturity</b></td><td id="projBalance" style="font-weight:800">$0</td></tr>
              </tbody>
            </table>
          </div>
        </details>

        <!-- HYSA comparison -->
        <div class="panel" style="margin-top:10px">
          <div class="k">High-Interest Account projection</div>
          <table class="table">
            <tbody>
              <tr><td>APR used</td><td id="hysaAprUsed">4.50%</td></tr>
              <tr><td>Projected interest</td><td id="hysaInterest">$0</td></tr>
              <tr><td><b>Projected balance @ same months</b></td><td id="hysaBalance" style="font-weight:800">$0</td></tr>
            </tbody>
          </table>
          <div class="note" style="margin-top:6px">Assumes same initial + recurring contributions and compounding chosen above.</div>
        </div>

        <!-- Delta -->
        <div class="panel" style="margin-top:10px">
          <div class="k">Difference (LockHabit − High-Interest)</div>
          <table class="table">
            <tbody>
              <tr><td>Interest delta</td><td id="deltaInt">$0</td></tr>
              <tr><td><b>Balance delta</b></td><td id="deltaBal" style="font-weight:800">$0</td></tr>
            </tbody>
          </table>
        </div>
      </aside>
    </div>
  </main>

  <footer>© <span id="yr"></span> LockHabit — Calculator is for estimates only.</footer>

  <!-- Schema (SEO) -->
  <script type="application/ld+json">
  {"@context":"https://schema.org","@type":"WebApplication","name":"LockHabit Take-Home Pay Calculator","url":"https://lockhabit.com/calculator.html","applicationCategory":"FinanceApplication","operatingSystem":"Any","offers":{"@type":"Offer","price":"0","priceCurrency":"USD"}}
  </script>

  <script>
    // ===== Constants (2025 ESTIMATES) =====
    const STATE_EFFECTIVE_RATES = {
      "AL":3.5,"AK":0,"AZ":2.5,"AR":4.0,"CA":6.0,"CO":4.5,"CT":5.0,"DC":6.0,"DE":4.5,
      "FL":0,"GA":4.0,"HI":6.0,"ID":4.7,"IL":4.7,"IN":3.0,"IA":4.2,"KS":4.2,"KY":4.0,
      "LA":3.0,"ME":5.0,"MD":4.8,"MA":5.0,"MI":4.1,"MN":5.7,"MS":3.0,"MO":3.8,"MT":4.5,
      "NE":4.5,"NV":0,"NH":0,"NJ":5.2,"NM":4.5,"NY":6.0,"NC":4.3,"ND":2.5,"OH":3.0,
      "OK":3.5,"OR":6.5,"PA":3.1,"RI":4.5,"SC":3.5,"SD":0,"TN":0,"TX":0,"UT":4.6,
      "VT":4.8,"VA":4.5,"WA":0,"WV":4.0,"WI":4.0,"WY":0
    };

    const FED_2025 = {
      std: { single: 15300, married: 30600 }, // est.
      single: [
        [12000, .10], [48700, .12], [104050, .22], [198700, .24],
        [252250, .32], [630650, .35], [Infinity, .37]
      ],
      married: [
        [24000, .10], [97600, .12], [208100, .22], [397300, .24],
        [504000, .32], [756600, .35], [Infinity, .37]
      ]
    };

    const SS_WAGEBASE_2025 = 174200;
    const SS_RATE = 0.062;
    const MEDICARE_RATE = 0.0145;

    // APR tiers (LockHabit)
    const APR_TIERS = [
      { min: 1,  apr: 0.020 },   // 1–5m → 2.0%
      { min: 6,  apr: 0.025 },   // 6–11m → 2.5%
      { min: 12, apr: 0.030 },   // 12–23m → 3.0%
      { min: 24, apr: 0.035 }    // 24m+ → 3.5%
    ];

    // ===== Utilities =====
    const $ = (id)=>document.getElementById(id);
    const fmt = (n)=> (isFinite(n)? n : 0).toLocaleString(undefined,{style:'currency',currency:'USD'});

    // Live year + header compact + tap-to-top
    $('yr').textContent = new Date().getFullYear();
    (function(){
      const hdr=$('hdr'), brand=$('brandTop');
      window.addEventListener('scroll', ()=> hdr.classList.toggle('small', window.scrollY>2), {passive:true});
      brand?.addEventListener('click', ()=>window.scrollTo({top:0,behavior:'smooth'}));
    })();

    // Inputs
    const freq = $('freq'), income = $('income'), status = $('status');
    const stateSel = $('state'), stateRate = $('stateRate'), useCustomState = $('useCustomState');
    const pretaxPct = $('pretaxPct'), exempt = $('exempt');
    const eH = $('expHousing'), eU = $('expUtils'), eD = $('expDebt'), eO = $('expOther');

    const lockFreq = $('lockFreq'), initDeposit = $('initDeposit'), recDeposit = $('recDeposit'), lockTerm = $('lockTerm');
    const customTermRow = $('customTermRow'), customMonths = $('customMonths'), aprMode = $('aprMode');

    // HYSA inputs
    const hysaApr = $('hysaApr'), hysaComp = $('hysaComp');

    // Outputs
    const outGross = $('outGross'), outPretax = $('outPretax'), outFed = $('outFed'), outState = $('outState'),
          outFica = $('outFica'), outNet = $('outNet'),
          netWeekly = $('netWeekly'), netBiweekly = $('netBiweekly'), netMonthly = $('netMonthly'),
          outExp = $('outExp'), outNetMonthly = $('outNetMonthly'), outSafe = $('outSafe'), safeFill = $('safeFill');

    const aprUsed = $('aprUsed'), projInterest = $('projInterest'), projBalance = $('projBalance');

    const hAprUsed = $('hysaAprUsed'), hInt = $('hysaInterest'), hBal = $('hysaBalance');
    const dInt = $('deltaInt'), dBal = $('deltaBal');

    // Hints on accordion headers
    const planHint=$('planHint'), hysaHint=$('hysaHint'), projHint=$('projHint');

    // ===== Build State dropdown (names only) =====
    (function buildStateSelect(){
      const NAMES = {
        AL:"Alabama", AK:"Alaska", AZ:"Arizona", AR:"Arkansas", CA:"California", CO:"Colorado", CT:"Connecticut",
        DC:"District of Columbia", DE:"Delaware", FL:"Florida", GA:"Georgia", HI:"Hawaii", ID:"Idaho", IL:"Illinois",
        IN:"Indiana", IA:"Iowa", KS:"Kansas", KY:"Kentucky", LA:"Louisiana", ME:"Maine", MD:"Maryland", MA:"Massachusetts",
        MI:"Michigan", MN:"Minnesota", MS:"Mississippi", MO:"Missouri", MT:"Montana", NE:"Nebraska", NV:"Nevada",
        NH:"New Hampshire", NJ:"New Jersey", NM:"New Mexico", NY:"New York", NC:"North Carolina", ND:"North Dakota",
        OH:"Ohio", OK:"Oklahoma", OR:"Oregon", PA:"Pennsylvania", RI:"Rhode Island", SC:"South Carolina", SD:"South Dakota",
        TN:"Tennessee", TX:"Texas", UT:"Utah", VT:"Vermont", VA:"Virginia", WA:"Washington", WV:"West Virginia",
        WI:"Wisconsin", WY:"Wyoming"
      };
      const frag = document.createDocumentFragment();
      Object.keys(STATE_EFFECTIVE_RATES).sort().forEach(ab=>{
        const opt = document.createElement('option');
        opt.value = ab;
        opt.textContent = `${ab} — ${NAMES[ab]}`;
        if(ab==="CA") opt.selected = true;
        frag.appendChild(opt);
      });
      stateSel.appendChild(frag);
    })();

    // Custom state toggle
    useCustomState?.addEventListener('change', ()=>{
      stateRate.disabled = !useCustomState.checked;
      recalc();
    });

    // ===== Conversions =====
    function toAnnualGross(amount, f){
      const a = Number(amount)||0;
      switch(f){
        case 'weekly': return a * 52;
        case 'biweekly': return a * 26;
        case 'monthly': return a * 12;
        default: return a; // annual
      }
    }

    // ===== Federal tax (2025 est.) =====
    function federalTax2025(taxable, filing){
      const d = filing === 'married' ? FED_2025.std.married : FED_2025.std.single;
      const x = Math.max(0, taxable - d);
      const B = filing === 'married' ? FED_2025.married : FED_2025.single;
      let prev = 0, tax = 0;
      for(const [cap, rate] of B){
        const slice = Math.min(x, cap) - prev;
        if(slice > 0){ tax += slice * rate; prev += slice; }
        if(prev >= x) break;
      }
      return Math.max(0, tax);
    }

    // ===== Payroll taxes (employee) =====
    function payrollTax(gross){
      const ss = Math.min(gross, SS_WAGEBASE_2025) * SS_RATE;
      const medicare = gross * MEDICARE_RATE;
      return ss + medicare;
    }

    // APR helpers (auto tiers)
    function aprForMonths(m){
      let a = APR_TIERS[0].apr;
      for(const t of APR_TIERS){ if(m >= t.min) a = t.apr; }
      return a;
    }

    // FV (monthly compounding baseline)
    function projectedBalance(init, recurring, freq, months, apr){
      const r = apr/12;
      const n = Math.max(0, Math.floor(months));
      const pmtPerMonth = (freq==='weekly') ? recurring*(52/12)
                         : (freq==='biweekly') ? recurring*(26/12)
                         : recurring;
      const fvLump = init * Math.pow(1+r, n);
      const fvSeries = r ? pmtPerMonth * ((Math.pow(1+r, n) - 1) / r) : pmtPerMonth * n;
      const balance = fvLump + fvSeries;
      const totalContrib = init + pmtPerMonth * n;
      return { balance, interest: Math.max(0, balance - totalContrib), apr };
    }

    // FV for HYSA (monthly or daily approx comp)
    function projectedHYSA(init, recurring, freq, months, apr, comp){
      const n = Math.max(0, Math.floor(months));
      const pmtPerMonth = (freq==='weekly') ? recurring*(52/12)
                         : (freq==='biweekly') ? recurring*(26/12)
                         : recurring;
      if(comp === 'daily'){
        const r = apr/365;
        const days = Math.round(n * 30.4375);
        let balance = init * Math.pow(1+r, days);
        for(let m=1; m<=n; m++){
          const remDays = Math.max(0, Math.round(days - m*30.4375));
          balance += pmtPerMonth * Math.pow(1+r, remDays);
        }
        const totalContrib = init + pmtPerMonth * n;
        return { balance, interest: Math.max(0, balance - totalContrib), apr };
      }
      return projectedBalance(init, recurring, 'monthly', months, apr);
    }

    // ===== Recalc =====
    function recalc(){
      // 1) Annualize gross
      const gross = toAnnualGross(income.value, freq.value);

      // 2) Pre-tax
      const prePct = Math.max(0, Math.min(50, Number(pretaxPct.value)||0))/100;
      const preTax = gross * prePct;
      const taxableWages = Math.max(0, gross - preTax);

      // 3) Taxes
      const isExempt = exempt.checked;
      const fed = isExempt ? 0 : federalTax2025(taxableWages, status.value);
      const eff = useCustomState.checked
        ? Math.max(0, Math.min(20, Number(stateRate.value)||0))
        : (STATE_EFFECTIVE_RATES[stateSel.value] ?? 4);
      if(!useCustomState.checked) stateRate.value = String(eff);
      const stateTax = isExempt ? 0 : taxableWages * (eff/100);
      const fica = isExempt ? 0 : payrollTax(taxableWages);

      // 4) Net annual/periods
      const netAnnual = Math.max(0, gross - preTax - fed - stateTax - fica);
      const netW = netAnnual / 52, netB = netAnnual / 26, netM = netAnnual / 12;

      // 5) Expenses & safe
      const expMonthly = (Number(eH.value)||0) + (Number(eU.value)||0) + (Number(eD.value)||0) + (Number(eO.value)||0);
      const leftoverMonthly = Math.max(0, netM - expMonthly);
      const suggested = Math.round(leftoverMonthly * 0.25);
      if(!(document.activeElement === recDeposit)) recDeposit.value = String(suggested);
      const pct = Math.max(0, Math.min(100, (suggested/(leftoverMonthly||1))*100));
      safeFill.style.width = pct.toFixed(0) + '%';

      // 6) Projection — LockHabit
      const baseMonths = (lockTerm.value === 'custom') ? Math.max(1, Number(customMonths.value||12))
                                                       : Number(lockTerm.value||12);
      const mode = (lockTerm.value === 'custom') ? aprMode.value : 'auto';
      const apr = (mode === 'fixed') ? 0.03 : aprForMonths(baseMonths);
      const pv = Number(initDeposit.value||0);
      const pmt = Math.max(0, Number(recDeposit.value||0));
      const proj = projectedBalance(pv, pmt, lockFreq.value, baseMonths, apr);

      // 7) Projection — HYSA
      const hApr = Math.max(0, Number(hysaApr.value||0))/100;
      const hComp = hysaComp.value; // 'monthly'|'daily'
      const h = projectedHYSA(pv, pmt, lockFreq.value, baseMonths, hApr, hComp);

      // 8) Reflect
      outGross.textContent = fmt(gross);
      outPretax.textContent = fmt(preTax);
      outFed.textContent = fmt(fed);
      outState.textContent = fmt(stateTax);
      outFica.textContent = fmt(fica);
      outNet.textContent = fmt(netAnnual);
      netWeekly.textContent = fmt(netW);
      netBiweekly.textContent = fmt(netB);
      netMonthly.textContent = fmt(netM);

      outExp.textContent = fmt(expMonthly);
      outNetMonthly.textContent = fmt(netM);
      outSafe.textContent = fmt(suggested);

      aprUsed.textContent = (apr*100).toFixed(2) + '%';
      projInterest.textContent = fmt(proj.interest);
      projBalance.textContent = fmt(proj.balance);

      hAprUsed.textContent = (hApr*100).toFixed(2) + '%';
      hInt.textContent = fmt(h.interest);
      hBal.textContent = fmt(h.balance);

      dInt.textContent = fmt(proj.interest - h.interest);
      dBal.textContent = fmt(proj.balance - h.balance);

      // Hints in accordion headers
      planHint.textContent = `${baseMonths} mo • ${(apr*100).toFixed(2)}% • ${lockFreq.value.replace('biweekly','bi-weekly')}`;
      hysaHint.textContent = `${(hApr*100).toFixed(2)}% • ${hComp}`;
      projHint.textContent = `${(apr*100).toFixed(2)}% • ${fmt(proj.balance)}`;
    }

    // Show/hide custom months
    function handleTermUI(){
      customTermRow.style.display = (lockTerm.value === 'custom') ? 'grid' : 'none';
    }
    lockTerm.addEventListener('change', ()=>{ handleTermUI(); recalc(); });
    customMonths.addEventListener('input', recalc);
    aprMode.addEventListener('change', recalc);

    // Wire up changes (including HYSA)
    const inputs = [
      freq,income,status,stateSel,stateRate,useCustomState,pretaxPct,exempt,
      eH,eU,eD,eO,
      lockFreq,initDeposit,recDeposit,lockTerm,customMonths,aprMode,
      hysaApr,hysaComp
    ];
    inputs.forEach(el => el.addEventListener('input', recalc));
    $('recalc').addEventListener('click', (e)=>{ e.preventDefault(); recalc(); });

    // Initialize state rate and calc
    function initStateRate(){ stateRate.value = String(STATE_EFFECTIVE_RATES[stateSel.value] ?? 4); }
    stateSel.addEventListener('change', ()=>{ if(!useCustomState.checked) initStateRate(); recalc(); });
    initStateRate();
    handleTermUI();
    recalc();

    // Deep-link params
    (function readParams(){
      const q = new URLSearchParams(location.search);
      if(q.has('freq')) freq.value = q.get('freq');
      if(q.has('income')) income.value = q.get('income');
      if(q.has('status')) status.value = q.get('status');
      if(q.has('state') && STATE_EFFECTIVE_RATES[q.get('state')]){ stateSel.value = q.get('state'); initStateRate(); }
      if(q.has('pretax')) pretaxPct.value = q.get('pretax');
      if(q.has('exempt')) exempt.checked = q.get('exempt') === '1';
      if(q.has('months')){
        lockTerm.value = 'custom';
        handleTermUI();
        customMonths.value = q.get('months');
      }
      if(q.has('hysa')) hysaApr.value = q.get('hysa');
      if(q.has('hcomp')) hysaComp.value = q.get('hcomp');
      recalc();
    })();

    // Waitlist CTA: open modal if site has it; otherwise go home anchor
    (function(){
      const btn = document.getElementById('ctaWaitlist');
      if(!btn) return;
      btn.addEventListener('click', ()=>{
        if(typeof window.openModal === 'function'){ window.openModal(); }
        else { window.location.href = '/index.html#waitlist'; }
      });
    })();
  </script>
</body>
</html>