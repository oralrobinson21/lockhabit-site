<!doctype html>
<html lang="en">
<head>
  <!-- =========================================================
       LockHabit — Salary & Take-Home Pay Calculator (2025, est.)
       Exact-state selector • Custom term (months) • Compounding
       ========================================================= -->
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover"/>
  <title>Salary & Take-Home Pay Calculator (2025 est.) — Weekly, Bi-weekly, Monthly | LockHabit</title>
  <meta name="description" content="Estimate 2025 take-home pay by week, bi-week, or month. Includes federal + payroll taxes, per-state estimate, pre-tax contributions, and expenses. See projected lock balance with compounding and send to the demo."/>
  <link rel="canonical" href="https://lockhabit.com/calculator.html"/>

  <!-- Social -->
  <meta property="og:type" content="website"/>
  <meta property="og:title" content="Salary & Take-Home Pay Calculator (2025 est.) — LockHabit"/>
  <meta property="og:description" content="Exact-state pick, 2025 (est.) taxes, custom lock term with compound interest. Send your plan to the LockHabit demo."/>
  <meta property="og:url" content="https://lockhabit.com/calculator.html"/>
  <meta property="og:image" content="https://lockhabit.com/assets/og-image.png"/>
  <meta name="twitter:card" content="summary_large_image"/>
  <meta name="theme-color" content="#6f7cff"/>

  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com"/>
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin/>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet"/>

  <!-- Icons/PWA -->
  <link rel="icon" href="/assets/favicon.svg" type="image/svg+xml">
  <link rel="alternate icon" href="/favicon.ico">
  <link rel="apple-touch-icon" href="/assets/icon-192.png">
  <link rel="manifest" href="/manifest.webmanifest">

  <style>
    :root{
      --brand:#6f7cff; --brand2:#9c78ff; --accent:#9fb2ff;
      --ink:#0f172a; --ink2:#15213d; --muted:#536179; --muted2:#3a4a66;
      --line:#e5e7f1; --panel:#ffffff; --surface:#fbfcff;
      --green:#22c55e; --danger:#b42318; --amber:#f59e0b;
      --bg:#0e1330; --radius:16px; --radius-lg:22px;
      --grad-hero:
        radial-gradient(1400px 700px at 50% -200px, rgba(111,124,255,.25), transparent 60%),
        radial-gradient(900px 600px at -10% 10%, rgba(156,120,255,.18), transparent 55%),
        #f6f8ff;
    }
    *{box-sizing:border-box}
    body{margin:0;background:var(--bg);color:var(--ink);
         font:16px/1.6 Inter,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;}
    .wrap{max-width:1100px;margin:0 auto;padding:16px 22px}
    header{position:sticky;top:0;z-index:40;background:rgba(255,255,255,.86);backdrop-filter:blur(10px);border-bottom:1px solid var(--line)}
    .row{display:flex;align-items:center;justify-content:space-between;gap:12px}
    .brand{display:flex;align-items:center;gap:10px}
    .logo{width:32px;height:32px}
    .word{font-weight:800;color:#0e1a34}
    .btn{appearance:none;border:1px solid var(--line);background:#fff;padding:10px 14px;border-radius:12px;font-weight:800;cursor:pointer}
    .btn.acc{background:linear-gradient(135deg,var(--brand),var(--brand2));color:#fff;border:0;box-shadow:0 10px 24px rgba(111,124,255,.35)}
    .btn.ghost{background:transparent}
    a{text-decoration:none;color:#19253f;font-weight:600}

    .hero{background:var(--grad-hero);border-bottom:1px solid var(--line);padding:44px 0}
    h1{margin:0 0 8px;font-size:36px}
    .sub{margin:0;color:#3a4a66;max-width:70ch}

    .grid{display:grid;grid-template-columns:1.2fr .8fr;gap:16px;margin-top:16px}
    .panel{background:#fff;border:1px solid var(--line);border-radius:16px;padding:16px}
    .k{font-size:12px;text-transform:uppercase;letter-spacing:.04em;color:#5b6a86;font-weight:700}
    .v{font-weight:800;color:#0f1a34}
    label.k{display:block;margin:8px 0 6px}
    input,select{width:100%;padding:12px;border:1px solid #dbe0ea;border-radius:12px;font-size:16px}
    input[type="checkbox"]{width:auto}
    .two{display:grid;grid-template-columns:1fr 1fr;gap:10px}
    .three{display:grid;grid-template-columns:1fr 1fr 1fr;gap:10px}
    .note{font-size:12px;color:#60708c}
    .warn{color:#5a1111;background:#ffeceb;border:1px solid #ffd4cf;border-radius:10px;padding:8px 10px;font-weight:700;display:inline-block}
    .ok{color:#0b3b22;background:#eafff2;border:1px solid #c8f5d9;border-radius:10px;padding:8px 10px;font-weight:700;display:inline-block}
    .actions{display:flex;gap:10px;flex-wrap:wrap;margin-top:12px}
    .bar{height:10px;border-radius:999px;background:#edf0f6;overflow:hidden;border:1px solid #e5e8f1}
    .fill{height:100%;width:0;background:linear-gradient(90deg,var(--green),var(--brand));transition:width .6s ease}

    .table{width:100%;border-collapse:collapse;margin-top:8px}
    .table th,.table td{padding:10px 8px;border-bottom:1px solid #eef1f7;text-align:right}
    .table th:first-child,.table td:first-child{text-align:left}
    .chip{display:inline-flex;gap:8px;align-items:center;border:1px solid #dfe3ff;background:#f3f6ff;border-radius:999px;padding:6px 10px;font-weight:700;color:#3a4a66}
    .center{display:flex;justify-content:center;align-items:center}

    footer{margin:22px 0;color:#cbd5e1;font-size:12px;text-align:center}
    @media (max-width:980px){ .grid{grid-template-columns:1fr} }
  </style>
</head>
<body>
  <!-- Header -->
  <header>
    <div class="wrap row">
      <div class="brand">
        <svg class="logo" viewBox="0 0 120 120" aria-hidden="true">
          <defs><linearGradient id="lg" x1="0" y1="0" x2="1" y2="1"><stop offset="0%" stop-color="#6f7cff"/><stop offset="100%" stop-color="#9c78ff"/></linearGradient></defs>
          <rect x="12" y="22" width="96" height="80" rx="18" fill="url(#lg)"/>
          <path d="M40 50c0-16 12-28 28-28s28 12 28 28" fill="none" stroke="#ffffff" stroke-width="8" stroke-linecap="round"/>
          <path d="M40 90V58" stroke="#ffffff" stroke-width="10" stroke-linecap="round"/>
          <path d="M40 90h26" stroke="#e7ecf8" stroke-width="8" stroke-linecap="round"/>
        </svg>
        <div class="word">LockHabit</div>
      </div>
      <nav class="row" style="gap:8px">
        <a href="/index.html">Home</a>
        <a href="/demo.html">Demo</a>
        <a aria-current="page" class="chip">Calculator</a>
      </nav>
    </div>
  </header>

  <!-- Hero -->
  <section class="hero">
    <div class="wrap">
      <h1>Salary & Take-Home Pay Calculator (2025 est.)</h1>
      <p class="sub">Estimate your <b>net</b> pay weekly, bi-weekly, or monthly. Pick your exact state, add expenses, choose a lock term (or enter your own), and see the <b>projected balance at maturity with compounding</b>. Send it to the demo in one click.</p>
    </div>
  </section>

  <!-- Main -->
  <main class="wrap">
    <div class="grid">
      <!-- Left: Inputs -->
      <section class="panel" aria-labelledby="inputs-title">
        <h2 id="inputs-title" style="margin:0 0 8px">Your details</h2>

        <div class="two">
          <div>
            <label class="k">Pay frequency</label>
            <select id="freq">
              <option value="weekly">Weekly</option>
              <option value="biweekly" selected>Bi-weekly</option>
              <option value="monthly">Monthly</option>
              <option value="annual">Annual</option>
            </select>
          </div>
          <div>
            <label class="k">Income (gross)</label>
            <input id="income" type="number" min="0" value="2000" inputmode="decimal"/>
          </div>
        </div>

        <div class="two" style="margin-top:8px">
          <div>
            <label class="k">Filing status</label>
            <select id="status">
              <option value="single" selected>Single</option>
              <option value="married">Married filing jointly</option>
            </select>
          </div>
          <div>
            <label class="k">State (effective estimate)</label>
            <select id="state"></select>
          </div>
        </div>

        <div class="two" style="margin-top:8px">
          <div class="center" style="justify-content:flex-start;gap:8px">
            <input id="useCustomState" type="checkbox"/>
            <label for="useCustomState" class="k" style="text-transform:none;letter-spacing:0">Override with custom state rate</label>
          </div>
          <div>
            <label class="k">Custom state tax %</label>
            <input id="stateRate" type="number" min="0" max="20" step="0.1" value="4" disabled/>
          </div>
        </div>

        <div class="two" style="margin-top:8px">
          <div>
            <label class="k">Pre-tax contribution (401k/HSA) %</label>
            <input id="pretaxPct" type="number" min="0" max="50" step="0.5" value="0"/>
          </div>
          <div class="center" style="justify-content:flex-start;gap:8px">
            <input id="exempt" type="checkbox"/>
            <label for="exempt" class="k" style="text-transform:none;letter-spacing:0">Tax-exempt (federal & state)</label>
          </div>
        </div>

        <hr style="border:none;border-top:1px solid #eef1f7;margin:12px 0"/>

        <h3 style="margin:4px 0 8px">Monthly expenses (optional)</h3>
        <div class="two">
          <div>
            <label class="k">Housing (rent/mortgage)</label>
            <input id="expHousing" type="number" min="0" value="1200"/>
          </div>
          <div>
            <label class="k">Utilities & phone</label>
            <input id="expUtils" type="number" min="0" value="250"/>
          </div>
        </div>
        <div class="two" style="margin-top:8px">
          <div>
            <label class="k">Debt payments</label>
            <input id="expDebt" type="number" min="0" value="300"/>
          </div>
          <div>
            <label class="k">Other essentials</label>
            <input id="expOther" type="number" min="0" value="350"/>
          </div>
        </div>

        <hr style="border:none;border-top:1px solid #eef1f7;margin:12px 0"/>

        <h3 style="margin:4px 0 8px">Your LockHabit plan</h3>
        <div class="two">
          <div>
            <label class="k">Contribution frequency</label>
            <select id="lockFreq">
              <option value="weekly">Weekly</option>
              <option value="biweekly" selected>Bi-weekly</option>
              <option value="monthly">Monthly</option>
            </select>
          </div>
          <div>
            <label class="k">Initial deposit</label>
            <input id="initDeposit" type="number" min="0" value="0"/>
          </div>
        </div>
        <div class="two" style="margin-top:8px">
          <div>
            <label class="k">Recurring deposit (suggested)</label>
            <input id="recDeposit" type="number" min="0" value="200"/>
          </div>
          <div>
            <label class="k">Lock term</label>
            <select id="lockTerm">
              <option value="3">3 months</option>
              <option value="6">6 months</option>
              <option value="12" selected>12 months</option>
              <option value="custom">Custom…</option>
            </select>
          </div>
        </div>

        <div class="two" id="customTermRow" style="margin-top:8px; display:none">
          <div>
            <label class="k">Custom months (1–60+)</label>
            <input id="customMonths" type="number" min="1" max="120" step="1" value="18"/>
          </div>
          <div>
            <label class="k">APR setting</label>
            <select id="aprMode">
              <option value="auto" selected>Auto (by term tiers)</option>
              <option value="fixed">Fixed 3% APR</option>
            </select>
          </div>
        </div>

        <div class="actions">
          <button id="recalc" class="btn">Recalculate</button>
          <button id="sendDemo" class="btn acc">Send to Demo</button>
          <a href="/demo.html" class="btn ghost">Open Demo</a>
        </div>

        <p class="note" style="margin-top:8px">
          This tool provides <b>estimates</b> using 2025 (est.) federal brackets & standard deduction and an estimated 2025 payroll wage base.
          State values are simple effective-rate approximations by state. Your actual withholding can differ (W-4 choices, credits, local taxes, benefits).
          For planning only.
        </p>
      </section>

      <!-- Right: Output -->
      <aside class="panel" aria-labelledby="out-title">
        <h2 id="out-title" style="margin:0 0 8px">Your snapshot</h2>

        <div class="two">
          <div>
            <div class="k">Annual gross</div>
            <div class="v" id="outGross">$0</div>
          </div>
          <div>
            <div class="k">Pre-tax contrib.</div>
            <div class="v" id="outPretax">$0</div>
          </div>
        </div>

        <div class="two" style="margin-top:8px">
          <div>
            <div class="k">Est. federal income tax</div>
            <div class="v" id="outFed">$0</div>
          </div>
          <div>
            <div class="k">Est. state income tax</div>
            <div class="v" id="outState">$0</div>
          </div>
        </div>

        <div class="two" style="margin-top:8px">
          <div>
            <div class="k">Payroll taxes (SS + Medicare)</div>
            <div class="v" id="outFica">$0</div>
          </div>
          <div>
            <div class="k">Annual net (est.)</div>
            <div class="v" id="outNet">$0</div>
          </div>
        </div>

        <div class="panel" style="margin-top:10px">
          <div class="k">Net by pay period</div>
          <table class="table" aria-describedby="perpay-note">
            <thead>
              <tr><th>Frequency</th><th>Net</th></tr>
            </thead>
            <tbody>
              <tr><td>Weekly</td><td id="netWeekly">$0</td></tr>
              <tr><td>Bi-weekly</td><td id="netBiweekly">$0</td></tr>
              <tr><td>Monthly</td><td id="netMonthly">$0</td></tr>
            </tbody>
          </table>
          <div id="perpay-note" class="note">Net per period = annual net ÷ periods (52 / 26 / 12).</div>
        </div>

        <div class="panel" style="margin-top:10px">
          <div class="k">Expenses & safe amount</div>
          <table class="table">
            <tbody>
              <tr><td>Monthly expenses</td><td id="outExp">$0</td></tr>
              <tr><td>Net monthly</td><td id="outNetMonthly">$0</td></tr>
              <tr><td><b>Safe to lock (suggested)</b></td><td id="outSafe" style="font-weight:800">$0</td></tr>
            </tbody>
          </table>
          <div class="bar" style="margin-top:8px"><div id="safeFill" class="fill"></div></div>
          <div class="note" style="margin-top:6px">We suggest ~20–30% of your <b>leftover</b> after essentials as a starting point. Adjust to your comfort.</div>
        </div>

        <div class="panel" style="margin-top:10px">
          <div class="k">End-of-lock projection (compounding)</div>
          <table class="table">
            <tbody>
              <tr><td>APR used</td><td id="aprUsed">3.00%</td></tr>
              <tr><td>Projected interest</td><td id="projInterest">$0</td></tr>
              <tr><td><b>Projected balance @ maturity</b></td><td id="projBalance" style="font-weight:800">$0</td></tr>
            </tbody>
          </table>
        </div>

        <div class="panel" style="margin-top:10px">
          <div class="k">What we’ll send to the Demo</div>
          <table class="table">
            <tbody>
              <tr><td>Initial deposit</td><td id="p_init">$0</td></tr>
              <tr><td>Recurring deposit</td><td id="p_rec">$0</td></tr>
              <tr><td>Contribution frequency</td><td id="p_freq">Bi-weekly</td></tr>
              <tr><td>Lock term</td><td id="p_term">12 months</td></tr>
              <tr><td>Mode</td><td id="p_mode">Safe (3% APR)</td></tr>
              <tr><td>Loan LTV (demo)</td><td id="p_ltv">75% of vested</td></tr>
            </tbody>
          </table>
        </div>
      </aside>
    </div>
  </main>

  <footer>© <span id="yr"></span> LockHabit — Calculator is for estimates only.</footer>

  <!-- Schema (SEO) -->
  <script type="application/ld+json">
  {
    "@context":"https://schema.org",
    "@type":"WebApplication",
    "name":"LockHabit Take-Home Pay Calculator",
    "url":"https://lockhabit.com/calculator.html",
    "applicationCategory":"FinanceApplication",
    "operatingSystem":"Any",
    "offers":{"@type":"Offer","price":"0","priceCurrency":"USD"}
  }
  </script>

  <script>
    // ===== Constants (2025 ESTIMATES) =====
    // Rough state effective rates (income tax only) — planning grade.
    const STATE_EFFECTIVE_RATES = {
      "AL":3.5,"AK":0,"AZ":2.5,"AR":4.0,"CA":6.0,"CO":4.5,"CT":5.0,"DC":6.0,"DE":4.5,
      "FL":0,"GA":4.0,"HI":6.0,"ID":4.7,"IL":4.7,"IN":3.0,"IA":4.2,"KS":4.2,"KY":4.0,
      "LA":3.0,"ME":5.0,"MD":4.8,"MA":5.0,"MI":4.1,"MN":5.7,"MS":3.0,"MO":3.8,"MT":4.5,
      "NE":4.5,"NV":0,"NH":0,"NJ":5.2,"NM":4.5,"NY":6.0,"NC":4.3,"ND":2.5,"OH":3.0,
      "OK":3.5,"OR":6.5,"PA":3.1,"RI":4.5,"SC":3.5,"SD":0,"TN":0,"TX":0,"UT":4.6,
      "VT":4.8,"VA":4.5,"WA":0,"WV":4.0,"WI":4.0,"WY":0
    };

    // 2025 federal (est.): standard deduction + bracket caps (Single/Married)
    const FED_2025 = {
      std: { single: 15300, married: 30600 }, // est.
      // caps are top of each bracket (taxed at rate); Infinity = top
      single: [
        [12000, .10], [48700, .12], [104050, .22], [198700, .24],
        [252250, .32], [630650, .35], [Infinity, .37]
      ],
      married: [
        [24000, .10], [97600, .12], [208100, .22], [397300, .24],
        [504000, .32], [756600, .35], [Infinity, .37]
      ]
    };

    // Payroll taxes (employee) — 2025 est.
    const SS_WAGEBASE_2025 = 174200; // Social Security cap
    const SS_RATE = 0.062;
    const MEDICARE_RATE = 0.0145; // ignoring additional surtax for simplicity

    // APR tiers (Auto mode): feel free to tune
    // key = min months in tier, value = APR
    const APR_TIERS = [
      { min: 1,  apr: 0.020 },   // 1–5m → 2.0%
      { min: 6,  apr: 0.025 },   // 6–11m → 2.5%
      { min: 12, apr: 0.030 },   // 12–17m → 3.0%
      { min: 18, apr: 0.0325 },  // 18–23m → 3.25%
      { min: 24, apr: 0.035 }    // 24m+ → 3.5%
    ];

    // ===== Utilities =====
    const $ = (id)=>document.getElementById(id);
    const fmt = (n)=> (isFinite(n)? n : 0).toLocaleString(undefined,{style:'currency',currency:'USD'});
    const pctFmt = (p)=> (p*100).toFixed(2)+'%';

    // Live year
    $('yr').textContent = new Date().getFullYear();

    // Inputs
    const freq = $('freq'), income = $('income'), status = $('status');
    const stateSel = $('state'), stateRate = $('stateRate'), useCustomState = $('useCustomState');
    const pretaxPct = $('pretaxPct'), exempt = $('exempt');
    const eH = $('expHousing'), eU = $('expUtils'), eD = $('expDebt'), eO = $('expOther');

    const lockFreq = $('lockFreq'), initDeposit = $('initDeposit'), recDeposit = $('recDeposit'), lockTerm = $('lockTerm');
    const customTermRow = $('customTermRow'), customMonths = $('customMonths'), aprMode = $('aprMode');

    // Outputs
    const outGross = $('outGross'), outPretax = $('outPretax'), outFed = $('outFed'), outState = $('outState'),
          outFica = $('outFica'), outNet = $('outNet'),
          netWeekly = $('netWeekly'), netBiweekly = $('netBiweekly'), netMonthly = $('netMonthly'),
          outExp = $('outExp'), outNetMonthly = $('outNetMonthly'), outSafe = $('outSafe'), safeFill = $('safeFill');

    const aprUsed = $('aprUsed'), projInterest = $('projInterest'), projBalance = $('projBalance');

    const p_init = $('p_init'), p_rec = $('p_rec'), p_freq = $('p_freq'), p_term = $('p_term'), p_mode = $('p_mode'), p_ltv = $('p_ltv');

    // ===== Populate state dropdown =====
    (function buildStateSelect(){
      const names = {
        AL:"Alabama", AK:"Alaska", AZ:"Arizona", AR:"Arkansas", CA:"California", CO:"Colorado", CT:"Connecticut",
        DC:"District of Columbia", DE:"Delaware", FL:"Florida", GA:"Georgia", HI:"Hawaii", ID:"Idaho", IL:"Illinois",
        IN:"Indiana", IA:"Iowa", KS:"Kansas", KY:"Kentucky", LA:"Louisiana", ME:"Maine", MD:"Maryland", MA:"Massachusetts",
        MI:"Michigan", MN:"Minnesota", MS:"Mississippi", MO:"Missouri", MT:"Montana", NE:"Nebraska", NV:"Nevada",
        NH:"New Hampshire", NJ:"New Jersey", NM:"New Mexico", NY:"New York", NC:"North Carolina", ND:"North Dakota",
        OH:"Ohio", OK:"Oklahoma", OR:"Oregon", PA:"Pennsylvania", RI:"Rhode Island", SC:"South Carolina", SD:"South Dakota",
        TN:"Tennessee", TX:"Texas", UT:"Utah", VT:"Vermont", VA:"Virginia", WA:"Washington", WV:"West Virginia",
        WI:"Wisconsin", WY:"Wyoming"
      };
      const frags = document.createDocumentFragment();
      // default common states at top
      const top = ["CA","NY","TX","FL","IL","PA"];
      top.forEach(ab=>{
        const opt = document.createElement('option');
        opt.value = ab;
        const r = STATE_EFFECTIVE_RATES[ab] ?? 4;
        opt.textContent = `${ab} — ${names[ab]} — ~${r}%`;
        frags.appendChild(opt);
      });
      const hr = document.createElement('option');
      hr.disabled = true; hr.textContent = '──────────';
      frags.appendChild(hr);
      // rest alphabetically
      Object.keys(STATE_EFFECTIVE_RATES).sort().forEach(ab=>{
        if(top.includes(ab)) return;
        const opt = document.createElement('option');
        const r = STATE_EFFECTIVE_RATES[ab] ?? 4;
        opt.value = ab;
        opt.textContent = `${ab} — ${names[ab]} — ~${r}%`;
        if(ab==="CA") opt.selected = true;
        frags.appendChild(opt);
      });
      stateSel.appendChild(frags);
    })();

    // Custom state toggle
    useCustomState.addEventListener('change', ()=>{
      stateRate.disabled = !useCustomState.checked;
      recalc();
    });

    // ===== Conversions =====
    function toAnnualGross(amount, f){
      const a = Number(amount)||0;
      switch(f){
        case 'weekly': return a * 52;
        case 'biweekly': return a * 26;
        case 'monthly': return a * 12;
        default: return a; // annual
      }
    }

    // ===== Federal tax (2025 est.) =====
    function federalTax2025(taxable, filing){
      const d = filing === 'married' ? FED_2025.std.married : FED_2025.std.single;
      const x = Math.max(0, taxable - d);
      const B = filing === 'married' ? FED_2025.married : FED_2025.single;
      let prev = 0, tax = 0;
      for(const [cap, rate] of B){
        const slice = Math.min(x, cap) - prev;
        if(slice > 0){ tax += slice * rate; prev += slice; }
        if(prev >= x) break;
      }
      return Math.max(0, tax);
    }

    // ===== Payroll taxes (employee) 2025 est. =====
    function payrollTax(gross){
      const ss = Math.min(gross, SS_WAGEBASE_2025) * SS_RATE;
      const medicare = gross * MEDICARE_RATE;
      return ss + medicare;
    }

    // ===== APR helpers (auto tiers) =====
    function aprForMonths(m){
      let a = APR_TIERS[0].apr;
      for(const t of APR_TIERS){ if(m >= t.min) a = t.apr; }
      return a;
    }

    // ===== FV with monthly compounding =====
    // FV = P0*(1+r)^n + PMT * [((1+r)^n - 1)/r]
    function projectedBalance(init, recurring, freq, months, apr, now=0){
      const r = apr/12;
      const n = Math.max(0, Math.floor(months));
      // Convert recurring frequency into an approximate monthly PMT
      const pmtPerMonth = (freq==='weekly') ? recurring*(52/12)
                         : (freq==='biweekly') ? recurring*(26/12)
                         : recurring; // monthly
      const fvLump = init * Math.pow(1+r, n);
      const fvSeries = pmtPerMonth * ((Math.pow(1+r, n) - 1) / (r || 1)); // handle r=0
      const balance = fvLump + fvSeries;
      const totalContrib = init + pmtPerMonth * n;
      return { balance, interest: Math.max(0, balance - totalContrib), apr };
    }

    // ===== Recalc =====
    function recalc(){
      // 1) Annualize gross
      const gross = toAnnualGross(income.value, freq.value);

      // 2) Pre-tax contributions
      const prePct = Math.max(0, Math.min(50, Number(pretaxPct.value)||0))/100;
      const preTax = gross * prePct;
      const taxableWages = Math.max(0, gross - preTax);

      // 3) Taxes
      const isExempt = exempt.checked;
      const fed = isExempt ? 0 : federalTax2025(taxableWages, status.value);
      const chosenState = stateSel.value;
      const eff = useCustomState.checked ? (Math.max(0, Math.min(20, Number(stateRate.value)||0)))
                                         : (STATE_EFFECTIVE_RATES[chosenState] ?? 4);
      stateRate.value = String(eff);
      const stateTax = isExempt ? 0 : taxableWages * (eff/100);
      const fica = isExempt ? 0 : payrollTax(taxableWages);

      // 4) Net annual
      const netAnnual = Math.max(0, gross - preTax - fed - stateTax - fica);

      // 5) Per-period
      const netW = netAnnual / 52;
      const netB = netAnnual / 26;
      const netM = netAnnual / 12;

      // 6) Expenses & safe amount
      const expMonthly = (Number(eH.value)||0) + (Number(eU.value)||0) + (Number(eD.value)||0) + (Number(eO.value)||0);
      const leftoverMonthly = Math.max(0, netM - expMonthly);
      const suggested = Math.round(leftoverMonthly * 0.25); // 25% of leftover as default
      if(!(document.activeElement === recDeposit)) recDeposit.value = String(suggested);

      // 7) Progress bar for “safe”
      const pct = Math.max(0, Math.min(100, (suggested/(leftoverMonthly||1))*100));
      safeFill.style.width = pct.toFixed(0) + '%';

      // 8) End-of-lock projection (compound)
      const baseMonths = (lockTerm.value === 'custom') ? Math.max(1, Number(customMonths.value||12))
                                                       : Number(lockTerm.value||12);
      const mode = (lockTerm.value === 'custom') ? aprMode.value : 'auto';
      const apr = (mode === 'fixed') ? 0.03 : aprForMonths(baseMonths);
      const pv = Number(initDeposit.value||0);
      const pmt = Math.max(0, Number(recDeposit.value||0));
      const proj = projectedBalance(pv, pmt, lockFreq.value, baseMonths, apr);

      // 9) Reflect on page
      outGross.textContent = fmt(gross);
      outPretax.textContent = fmt(preTax);
      outFed.textContent = fmt(fed);
      outState.textContent = fmt(stateTax);
      outFica.textContent = fmt(fica);
      outNet.textContent = fmt(netAnnual);
      netWeekly.textContent = fmt(netW);
      netBiweekly.textContent = fmt(netB);
      netMonthly.textContent = fmt(netM);

      outExp.textContent = fmt(expMonthly);
      outNetMonthly.textContent = fmt(netM);
      outSafe.textContent = fmt(suggested);

      aprUsed.textContent = (apr*100).toFixed(2) + '%';
      projInterest.textContent = fmt(proj.interest);
      projBalance.textContent = fmt(proj.balance);

      p_init.textContent = fmt(Number(initDeposit.value||0));
      p_rec.textContent = fmt(Number(recDeposit.value||0));
      p_freq.textContent = {weekly:'Weekly',biweekly:'Bi-weekly',monthly:'Monthly'}[lockFreq.value] || 'Bi-weekly';
      p_term.textContent = `${baseMonths} months`;
      p_mode.textContent = (mode==='fixed') ? 'Safe (fixed 3% APR)' : 'Safe (auto tiers)';
      p_ltv.textContent = '75% of vested';

      return { gross, preTax, fed, stateTax, fica, netAnnual, netW, netB, netM, expMonthly, suggested, proj, months: baseMonths, aprMode: mode };
    }

    // Show/hide custom months row
    function handleTermUI(){
      customTermRow.style.display = (lockTerm.value === 'custom') ? 'grid' : 'none';
    }
    lockTerm.addEventListener('change', ()=>{ handleTermUI(); recalc(); });
    customMonths.addEventListener('input', recalc);
    aprMode.addEventListener('change', recalc);
    handleTermUI();

    // Wire up changes
    [freq,income,status,stateSel,stateRate,useCustomState,pretaxPct,exempt,eH,eU,eD,eO,lockFreq,initDeposit,recDeposit,lockTerm,customMonths,aprMode]
      .forEach(el => el.addEventListener('input', recalc));
    $('recalc').addEventListener('click', recalc);

    // Send to Demo (via query params) — match demo’s expected keys
    $('sendDemo').addEventListener('click', ()=>{
      const init = Math.max(0, Number(initDeposit.value||0));
      const save = Math.max(0, Number(recDeposit.value||0)); // NOTE: 'save' (not 'rec') for demo
      const lf = lockFreq.value;
      const term = (lockTerm.value === 'custom') ? Math.max(1, Number(customMonths.value||12))
                                                 : Number(lockTerm.value||12);
      const mode = 'safe';
      const params = new URLSearchParams({ init:String(init), save:String(save), freq:lf, term:String(term), mode });

      // Also stash to localStorage for the demo to read
      localStorage.setItem('lh_plan', JSON.stringify({ init, save, freq: lf, term, mode }));

      window.location.href = '/demo.html?' + params.toString();
    });

    // Initialize
    const initStateRate = ()=>{ stateRate.value = String(STATE_EFFECTIVE_RATES[stateSel.value] ?? 4); };
    stateSel.addEventListener('change', ()=>{ if(!useCustomState.checked) initStateRate(); recalc(); });
    initStateRate();
    recalc();

    // Deep-link support (optional): ?freq=biweekly&income=1800&state=CA&pretax=5&months=18
    (function readParams(){
      const q = new URLSearchParams(location.search);
      if(q.has('freq')) freq.value = q.get('freq');
      if(q.has('income')) income.value = q.get('income');
      if(q.has('status')) status.value = q.get('status');
      if(q.has('state') && STATE_EFFECTIVE_RATES[q.get('state')]){ stateSel.value = q.get('state'); initStateRate(); }
      if(q.has('pretax')) pretaxPct.value = q.get('pretax');
      if(q.has('exempt')) exempt.checked = q.get('exempt') === '1';
      if(q.has('months')){
        lockTerm.value = 'custom';
        handleTermUI();
        customMonths.value = q.get('months');
      }
      recalc();
    })();
  </script>
</body>
</html>