<!doctype html>
<html lang="en">
<head>
  <!-- =========================================================
       LockHabit — Demo (Simulated Account)
       Reads plan from URL or localStorage('lh_plan')
       ========================================================= -->
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover"/>
  <title>LockHabit Demo — Simulated Account</title>
  <meta name="description" content="Try LockHabit’s simulated account. See your progress build, interest accrue, and what you could borrow (75% of vested). Pre-filled from the calculator or customize here."/>
  <meta name="theme-color" content="#6f7cff"/>

  <!-- Canonical + Social -->
  <link rel="canonical" href="https://lockhabit.com/demo.html"/>
  <meta property="og:type" content="website"/>
  <meta property="og:title" content="LockHabit — Live Demo"/>
  <meta property="og:description" content="Interactive demo: savings lock with 3% APR (or high-risk sim), progress over time, and 75% vested borrowing."/>
  <meta property="og:image" content="https://lockhabit.com/assets/og-image.png"/>
  <meta property="og:url" content="https://lockhabit.com/demo.html"/>
  <meta name="twitter:card" content="summary_large_image"/>

  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com"/>
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin/>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet"/>

  <style>
    :root{
      --brand:#6f7cff; --brand2:#9c78ff; --ink:#0e1630; --muted:#56617a; --line:#e6e9f2;
      --green:#16a34a; --danger:#b42318; --panel:#ffffff; --bg:#0b0e1a;
      --grad: radial-gradient(1400px 700px at 50% -200px, rgba(111,124,255,.20), transparent 60%),
              radial-gradient(1000px 600px at -10% 10%, rgba(156,120,255,.15), transparent 55%),
              #f8f9ff;
      --shadow:0 24px 60px rgba(10,15,35,.14);
      --r:18px;
    }
    *{box-sizing:border-box}
    body{margin:0;background:var(--bg);color:var(--ink);
         font:16px/1.6 Inter,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;}
    a{color:#1f2c56}
    .wrap{max-width:1100px;margin:0 auto;padding:16px 20px}

    /* Header */
    .header{position:sticky;top:0;z-index:50;backdrop-filter:blur(8px);
      background:rgba(255,255,255,.9);border-bottom:1px solid var(--line)}
    .row{display:flex;align-items:center;justify-content:space-between;gap:12px}
    .brand{display:flex;align-items:center;gap:10px}
    .logo{width:30px;height:30px}
    .word{font-weight:800}
    .btn{appearance:none;border:1px solid var(--line);background:#fff;padding:10px 14px;border-radius:12px;font-weight:800;cursor:pointer;min-height:40px}
    .btn.acc{background:linear-gradient(135deg,var(--brand),var(--brand2));color:#fff;border:0;box-shadow:0 12px 30px rgba(111,124,255,.3)}
    .btn.ghost{background:transparent}
    .pill{display:inline-flex;gap:8px;align-items:center;border:1px solid #dfe3ff;background:#f3f6ff;border-radius:999px;padding:6px 10px;font-weight:700}

    /* Hero */
    .hero{background:var(--grad);padding:26px 0;border-bottom:1px solid var(--line)}
    h1{margin:0 0 6px;font-size:32px}
    .sub{color:#3a4a66;margin:0}

    /* Cards & layout */
    .card{margin-top:16px;background:#fff;border:1px solid var(--line);border-radius:22px;padding:18px;box-shadow:var(--shadow)}
    .big{display:flex;align-items:flex-start;justify-content:space-between;gap:12px;flex-wrap:wrap}
    .balance{font-size:36px;font-weight:800;color:#0e1a34}
    .muted{color:#5b6a86}
    .kpi{display:grid;grid-template-columns:repeat(4,minmax(0,1fr));gap:12px;margin-top:10px}
    .kpi .box{border:1px solid var(--line);border-radius:14px;padding:12px;background:#fbfcff}
    .k{font-size:12px;color:#5b6a86;text-transform:uppercase;letter-spacing:.04em}
    .v{font-weight:800;font-size:20px;color:#0f1a34}
    .bar{height:10px;border-radius:999px;background:#edf0f6;overflow:hidden;border:1px solid #e5e8f1}
    .fill{height:100%;width:0;background:linear-gradient(90deg,var(--green),var(--brand));transition:width .6s ease}
    .actions{display:flex;flex-wrap:wrap;gap:10px;margin-top:14px}
    .panel{margin-top:16px;background:#fff;border:1px solid var(--line);border-radius:18px;padding:16px}
    .panel h3{margin:0 0 8px}

    /* Controls row */
    .controls{display:grid;grid-template-columns:repeat(6,minmax(0,1fr));gap:10px}
    .controls .box{background:#fff;border:1px solid var(--line);border-radius:12px;padding:10px}
    label{font-size:12px;color:#5b6a86;display:block;margin-bottom:6px;text-transform:uppercase;letter-spacing:.04em}
    input,select{width:100%;padding:10px;border:1px solid #dbe0ea;border-radius:10px;font-size:16px}
    input[type="range"]{padding:0}

    .note{font-size:12px;color:#5b6a86}
    .ok{color:#0b3b22;background:#eafff2;border:1px solid #c8f5d9;border-radius:10px;padding:8px 10px;font-weight:700;display:inline-block}
    .warn{color:#5a1111;background:#ffeceb;border:1px solid #ffd4cf;border-radius:10px;padding:8px 10px;font-weight:700;display:inline-block}
    .footnote{font-size:12px;color:#60708c;margin-top:10px}

    /* Modal */
    .overlay{position:fixed;inset:0;background:rgba(10,14,30,.55);backdrop-filter:blur(3px);display:none;align-items:center;justify-content:center;z-index:60}
    .modal{width:min(620px,92vw);background:#fff;border:1px solid var(--line);border-radius:16px;padding:18px;box-shadow:var(--shadow)}
    .x{border:0;background:transparent;font-size:20px;cursor:pointer;color:#64748b}
    .grid2{display:grid;grid-template-columns:repeat(2,minmax(0,1fr));gap:12px}

    footer{margin:20px 0;color:#cbd5e1;font-size:12px;text-align:center}

    /* Responsive */
    @media (max-width:1000px){
      .kpi{grid-template-columns:1fr 1fr}
      .controls{grid-template-columns:1fr 1fr 1fr}
    }
    @media (max-width:640px){
      .kpi{grid-template-columns:1fr}
      .controls{grid-template-columns:1fr}
    }
  </style>
</head>
<body>
  <!-- HEADER -->
 <!-- HEADER -->
<div class="header">
  <div class="wrap row">
    <div class="brand">
      <svg class="logo" viewBox="0 0 120 120" aria-hidden="true">
        <defs><linearGradient id="lg" x1="0" y1="0" x2="1" y2="1"><stop offset="0%" stop-color="#6f7cff"/><stop offset="100%" stop-color="#9c78ff"/></linearGradient></defs>
        <rect x="12" y="22" width="96" height="80" rx="18" fill="url(#lg)"/>
        <path d="M40 50c0-16 12-28 28-28s28 12 28 28" fill="none" stroke="#ffffff" stroke-width="8" stroke-linecap="round"/>
        <path d="M40 90V58" stroke="#ffffff" stroke-width="10" stroke-linecap="round"/>
        <path d="M40 90h26" stroke="#e7ecf8" stroke-width="8" stroke-linecap="round"/>
      </svg>
      <div class="word">LockHabit — Demo</div>
    </div>
    <div class="row" style="gap:8px">
      <a class="btn ghost" href="/">← Home</a>
      <a class="btn" href="/calculator.html">Open calculator</a>
      <a class="btn" href="#simulate">Jump to demo</a>
      <button class="btn acc" id="btnWaitlist" type="button">Join waitlist</button>
    </div>
  </div>
</div>
  <!-- HERO -->
  <div class="hero">
    <div class="wrap">
      <h1>Simulated Account</h1>
      <p class="sub">Pre-filled from your calculator inputs. Adjust anything and watch the progress and interest update in real time. Borrowing power is <b>75% of vested</b> funds.</p>

      <!-- Live balances -->
      <div class="card" id="simulate">
        <div class="big">
          <div>
            <div class="muted">Total Locked Balance</div>
            <div class="balance" id="balance">$1,500.00</div>
            <div class="muted">
              Lock: <b id="termLabel">12 months</b> • Next deposit: <b id="nextDepAmt">$200</b> in <b id="nextDep">14 days</b>
            </div>
          </div>
          <span class="pill" id="modePill">Safe • 3% APR</span>
        </div>

        <!-- Progress + KPIs -->
        <div class="panel">
          <div class="row" style="gap:12px;align-items:center">
            <div style="flex:1">
              <div class="muted">Progress toward maturity</div>
              <div class="bar"><div class="fill" id="pbar" style="width:0%"></div></div>
            </div>
            <div class="v" id="pval">0%</div>
          </div>

          <div class="kpi">
            <div class="box">
              <div class="k">Interest Earned So Far</div>
              <div class="v" id="intSoFar">$0.00</div>
            </div>
            <div class="box">
              <div class="k">Projected Interest @ Maturity</div>
              <div class="v" id="intProj">$0.00</div>
            </div>
            <div class="box">
              <div class="k">Vested Funds (so far)</div>
              <div class="v" id="vested">$0.00</div>
            </div>
            <div class="box">
              <div class="k">Loan Eligible (75% of vested)</div>
              <div class="v" id="loanElig">$0.00</div>
            </div>
          </div>

          <div class="actions">
            <button class="btn acc" id="btnLoan">Request a self-loan</button>
            <button class="btn" id="btnExtend">Extend term</button>
            <button class="btn" id="btnCashout">Cash out (simulate)</button>
            <button class="btn ghost" id="btnExplain">How this works</button>
          </div>
          <div class="footnote">
            Demo only. Illustrative rates & fees. High-risk mode can lose money. This is not financial advice.
          </div>
        </div>
      </div>

      <!-- Inline controls (quick edits) -->
      <div class="panel">
        <h3>Adjust your plan</h3>
        <div class="controls">
          <div class="box">
            <label>Initial deposit</label>
            <input id="c_init" type="number" min="0" step="1" value="1500"/>
          </div>
          <div class="box">
            <label>Recurring deposit</label>
            <input id="c_rec" type="number" min="0" step="1" value="200"/>
          </div>
          <div class="box">
            <label>Frequency</label>
            <select id="c_freq">
              <option value="weekly">Weekly</option>
              <option value="biweekly" selected>Bi-weekly</option>
              <option value="monthly">Monthly</option>
            </select>
          </div>
          <div class="box">
            <label>Term (months)</label>
            <input id="c_term" type="range" min="1" max="36" step="1" value="12"/>
            <div class="muted" id="c_term_lbl">12 months</div>
          </div>
          <div class="box">
            <label>Mode</label>
            <select id="c_mode">
              <option value="safe" selected>Safe (3% APR)</option>
              <option value="risk">High-risk sim (15%/yr ± volatility)</option>
            </select>
          </div>
          <div class="box">
            <label>Save as default</label>
            <button class="btn" id="btnSavePlan" type="button">Save plan</button>
          </div>
        </div>
        <div class="note" id="riskNote" style="display:none;margin-top:6px">
          High-risk mode is an illustration akin to aggressive ETFs. Values may go down. For demo only.
        </div>
      </div>

      <!-- What you’ll see -->
      <div class="panel">
        <h3>What this demo shows</h3>
        <ul>
          <li>A progress bar moving across your full lock term (default: 12 months).</li>
          <li>Interest accrues over time. In risk mode, returns wobble (can be negative).</li>
          <li>Borrowing power equals <b>75% of vested funds</b> (initial + deposits that would have happened so far).</li>
          <li>“Extend term” increases projected interest and adjusts the unlock fee tier.</li>
          <li>“Cash out” shows principal + interest − flat unlock fee ($3 / $2 / $1 by term).</li>
        </ul>
      </div>
    </div>
  </div>

  <!-- MODAL -->
  <div id="overlay" class="overlay" aria-modal="true" role="dialog">
    <div class="modal" id="modalBox" role="document">
      <div class="row">
        <h3 id="modalTitle" style="margin:0">Modal</h3>
        <button class="x" id="modalClose">✕</button>
      </div>
      <div id="modalBody" style="margin-top:8px"></div>
    </div>
  </div>

  <footer>© <span id="yr"></span> LockHabit — Demo simulation.</footer>

  <script>
    // ================== Helpers & Inputs ==================
    const yrEl = document.getElementById('yr'); yrEl.textContent = new Date().getFullYear();
    const qs = new URLSearchParams(location.search);
    const getNum = (k, d) => {
      const v = qs.get(k);
      if(v===null) return d;
      const n = Number(v);
      return Number.isFinite(n) ? n : d;
    };
    const getStr = (k, d) => qs.get(k) || d;

    // Try to read a calculator plan from localStorage
    let plan = null;
    try { plan = JSON.parse(localStorage.getItem('lh_plan') || 'null'); } catch(_){ plan=null; }

    // Defaults (can be overridden by URL or localStorage plan)
    let principal = getNum('init', plan?.init ?? 1500);           // initial deposit
    let recurring = getNum('save', plan?.save ?? 200);            // recurring deposit amount
    let freq      = getStr('freq', plan?.freq ?? 'biweekly');     // weekly, biweekly, monthly
    let months    = getNum('term', plan?.term ?? 12);             // lock length
    let mode      = getStr('mode', plan?.mode ?? 'safe');         // safe | risk

    // Rates
    const aprSafe = 0.03;
    const aprRisk = 0.15;  // demo only; not advice
    const aprLoan = 0.06;  // loan APR for payment calc
    const riskVol = 0.08;  // wobble factor (demo)

    // DOM refs
    const balEl = document.getElementById('balance');
    const termLabel = document.getElementById('termLabel');
    const nextDep = document.getElementById('nextDep');
    const nextDepAmt = document.getElementById('nextDepAmt');
    const intSoFar = document.getElementById('intSoFar');
    const intProj = document.getElementById('intProj');
    const vestedEl = document.getElementById('vested');
    const loanElig = document.getElementById('loanElig');
    const pbar = document.getElementById('pbar');
    const pval = document.getElementById('pval');
    const modePill = document.getElementById('modePill');

    // Controls
    const c_init = document.getElementById('c_init');
    const c_rec = document.getElementById('c_rec');
    const c_freq = document.getElementById('c_freq');
    const c_term = document.getElementById('c_term');
    const c_term_lbl = document.getElementById('c_term_lbl');
    const c_mode = document.getElementById('c_mode');
    const riskNote = document.getElementById('riskNote');
    const btnSavePlan = document.getElementById('btnSavePlan');

    // Apply initial values to controls
    c_init.value = principal;
    c_rec.value = recurring;
    c_freq.value = freq;
    c_term.value = months;
    c_term_lbl.textContent = months + ' months';
    c_mode.value = mode;
    riskNote.style.display = (mode === 'risk') ? 'block' : 'none';
    modePill.textContent = (mode === 'risk') ? 'High-risk sim • 15% APR ± volatility' : 'Safe • 3% APR';

    // ================== Core math helpers ==================
    function weeksInMonths(m){ return m * 4.345; } // average
    function cyclesFor(freq, months){
      const w = weeksInMonths(months);
      if(freq === 'weekly') return Math.floor(w);
      if(freq === 'biweekly') return Math.floor(w/2);
      return months; // monthly
    }
    function nextDepositCountdown(freq){
      // purely illustrative countdown
      if(freq === 'weekly') return '7 days';
      if(freq === 'biweekly') return '14 days';
      return '30 days';
    }
    function feeForTerm(m){
      if(m <= 3) return 3;
      if(m <= 6) return 2;
      return 1;
    }
    function fmt(n){ return n.toLocaleString(undefined,{style:'currency',currency:'USD'}); }

    // Vested amount = initial + #deposits that would have happened so far * recurring
    function vestedAmount(progressPct){
      const totalCycles = cyclesFor(freq, months);
      const cyclesSoFar = Math.floor(totalCycles * (progressPct/100));
      return principal + (cyclesSoFar * recurring);
    }

    // Balance now (naive, illustrative): vested + interest so far (safe or risk)
    function interestProjectedFullTerm(){
      const base = principal + (cyclesFor(freq, months) * recurring);
      const apr = (mode==='risk') ? aprRisk : aprSafe;
      return base * apr * (months/12);
    }

    // Interest so far (linearly by progress, with wobble for risk)
    function interestSoFar(progressPct){
      const proj = interestProjectedFullTerm();
      if(mode === 'safe') return proj * (progressPct/100);
      // risk wobble around linear path
      const wobble = Math.sin(Date.now()/600) * riskVol * proj * (progressPct/100);
      return Math.max(0, proj * (progressPct/100) + wobble);
    }

    // ================== Animation & UI ==================
    let progress = 0; // 0..100
    function updateUI(){
      // Labels
      termLabel.textContent = months + ' months';
      nextDepAmt.textContent = fmt(recurring);
      nextDep.textContent = nextDepositCountdown(freq);

      // Progress bar
      pbar.style.width = progress.toFixed(0) + '%';
      pval.textContent = progress.toFixed(0) + '%';

      const vested = vestedAmount(progress);
      const interestNow = interestSoFar(progress);
      const interestFull = interestProjectedFullTerm();
      const balNow = vested + interestNow;

      balEl.textContent = fmt(balNow);
      intSoFar.textContent = fmt(interestNow);
      intProj.textContent = fmt(interestFull);
      vestedEl.textContent = fmt(vested);
      loanElig.textContent = fmt(Math.max(0, vested * 0.75));
    }

    // Animate progress up to 100 then hold (or loop mildly)
    let looping = true;
    setInterval(()=>{
      // Increase slower as it nears 100 so users can read KPIs
      const step = progress < 85 ? (1.5 + Math.random()*2.5) : (0.5 + Math.random()*1.2);
      progress = Math.min(100, progress + step);
      if(progress >= 100 && looping){
        // pause at 100 for a while then drift back a bit
        looping = false;
        setTimeout(()=>{ progress = 92; looping = true; }, 4500);
      }
      updateUI();
    }, 900);

    updateUI();

    // ================== Modal System ==================
    const overlay = document.getElementById('overlay');
    const modalTitle = document.getElementById('modalTitle');
    const modalBody = document.getElementById('modalBody');
    const modalClose = document.getElementById('modalClose');
    function openModal(title, html){
      modalTitle.textContent = title;
      modalBody.innerHTML = html;
      overlay.style.display = 'flex';
      document.body.style.overflow='hidden';
    }
    function closeModal(){ overlay.style.display='none'; document.body.style.overflow=''; }
    modalClose.addEventListener('click', closeModal);
    overlay.addEventListener('click', (e)=>{ if(e.target===overlay) closeModal(); });

    // ================== Actions ==================
    document.getElementById('btnExplain').addEventListener('click', ()=>{
      openModal('How this demo works', `
        <p>This is an interactive simulation. It assumes a lock with deposits over your chosen term.</p>
        <ul>
          <li><b>Progress</b> shows time passing in your selected term.</li>
          <li><b>Vested</b> = initial + deposits that would have occurred so far.</li>
          <li><b>Borrowing power</b> = 75% of vested.</li>
          <li><b>Interest</b> accrues over time. In high-risk mode, values may go down.</li>
          <li>At cash out: principal + interest − a small flat fee ($3 / $2 / $1 by term).</li>
        </ul>
        <div class="note">Estimates only; not financial advice. Rates/fees subject to change.</div>
      `);
    });

    document.getElementById('btnExtend').addEventListener('click', ()=>{
      openModal('Extend Term', `
        <p>Extend your lock to keep earning.</p>
        <div class="grid2">
          <div>
            <label>Add Months</label>
            <select id="extendSel">
              <option value="3">+3 months</option>
              <option value="6" selected>+6 months</option>
              <option value="12">+12 months</option>
            </select>
          </div>
          <div>
            <label>New Unlock Fee</label>
            <div class="v" id="newFee">${fmt(feeForTerm(months+6))}</div>
          </div>
        </div>
        <div class="actions" style="margin-top:12px">
          <button class="btn acc" id="doExtend">Confirm extend</button>
          <button class="btn" onclick="(${closeModal.toString()})()">Cancel</button>
        </div>
        <div class="note">Extending avoids a fee right now; fee applies when the new term ends.</div>
      `);
      const sel = document.getElementById('extendSel');
      const feeEl = document.getElementById('newFee');
      sel.addEventListener('change', ()=> feeEl.textContent = fmt(feeForTerm(months+Number(sel.value))));
      document.getElementById('doExtend').addEventListener('click', ()=>{
        months += Number(sel.value);
        c_term.value = months; c_term_lbl.textContent = months + ' months';
        updateUI();
        closeModal();
        setTimeout(()=>openModal('Extended', `<div class="ok">✅ New term: <b>${months} months</b>.</div>`), 60);
      });
    });

    document.getElementById('btnLoan').addEventListener('click', ()=>{
      const vested = vestedAmount(progress);
      const max = Math.floor(vested * 0.75);
      const def = Math.min(500, Math.max(100, max));
      openModal('Request a Self-Backed Loan', `
        <p>Borrow against your vested funds (75%). Loan interest is credited back to your locked balance after payoff.</p>
        <label class="k">Loan Amount: <span id="loanAmtVal">${fmt(def)}</span></label>
        <input id="loanAmt" type="range" min="100" max="${max}" step="50" value="${def}"/>
        <div class="grid2" style="margin-top:8px">
          <div>
            <label>Repayment Term</label>
            <select id="loanTerm">
              <option value="3" selected>3 months</option>
              <option value="6">6 months</option>
              <option value="12">12 months</option>
            </select>
          </div>
          <div>
            <label>Monthly Payment</label>
            <div class="v" id="loanPmt">$0.00</div>
          </div>
        </div>
        <div class="kpi" style="display:grid;grid-template-columns:repeat(2,minmax(0,1fr));gap:10px;margin-top:10px">
          <div class="box"><div class="k">Total Repay</div><div class="v" id="loanTotal">$0.00</div></div>
          <div class="box"><div class="k">Interest (back to you)</div><div class="v" id="loanIntBack">$0.00</div></div>
        </div>
        <div class="note" style="margin-top:8px">On-time payments may help your credit; late payments may harm it. Demo only.</div>
        <div class="actions" style="margin-top:12px">
          <button class="btn acc" id="doLoan">Request loan</button>
          <button class="btn" onclick="(${closeModal.toString()})()">Cancel</button>
        </div>
      `);

      const amt = document.getElementById('loanAmt');
      const amtVal = document.getElementById('loanAmtVal');
      const termSel = document.getElementById('loanTerm');
      const pmtEl = document.getElementById('loanPmt');
      const totalEl = document.getElementById('loanTotal');
      const intBackEl = document.getElementById('loanIntBack');

      function recalc(){
        const A = Number(amt.value);
        const m = Number(termSel.value);
        amtVal.textContent = fmt(A);
        // simple demo interest calc
        const interest = A * aprLoan * (m/12);
        const total = A + interest;
        const monthly = total / m;
        pmtEl.textContent = fmt(monthly);
        totalEl.textContent = fmt(total);
        intBackEl.textContent = fmt(interest);
      }
      amt.addEventListener('input', recalc);
      termSel.addEventListener('change', recalc);
      recalc();

      document.getElementById('doLoan').addEventListener('click', ()=>{
        closeModal();
        setTimeout(()=>openModal('Loan Simulated', `
          <div class="ok">✅ Funds released (demo).</div>
          <p>Your monthly payment is shown above. All loan interest is credited back to your locked balance after payoff.</p>
          <div style="text-align:right"><button class="btn acc" onclick="(${closeModal.toString()})()">Close</button></div>
        `), 120);
      });
    });

    document.getElementById('btnCashout').addEventListener('click', ()=>{
      const fee = feeForTerm(months);
      const vested = vestedAmount(progress);
      const interestNow = interestSoFar(progress);
      const gross = vested + interestNow;
      const net = gross - fee;
      openModal('Cash Out (Simulation)', `
        <div class="kpi" style="display:grid;grid-template-columns:repeat(2,minmax(0,1fr));gap:10px">
          <div class="box"><div class="k">Vested Funds</div><div class="v">${fmt(vested)}</div></div>
          <div class="box"><div class="k">Interest Earned</div><div class="v">${fmt(interestNow)}</div></div>
          <div class="box"><div class="k">Unlock Fee</div><div class="v">-${fmt(fee)}</div></div>
          <div class="box"><div class="k">Net to You</div><div class="v">${fmt(net)}</div></div>
        </div>
        <div class="actions" style="margin-top:12px">
          <button class="btn acc" id="doRelock">Relock & keep earning</button>
          <button class="btn" onclick="(${closeModal.toString()})()">Close</button>
        </div>
        <div class="note">In production you’d choose a destination account. Demo only.</div>
      `);
      document.getElementById('doRelock').addEventListener('click', ()=>{
        progress = 0; updateUI(); closeModal();
        setTimeout(()=>openModal('Relocked', `<div class="ok">✅ Balance relocked for another ${months} months.</div>`), 80);
      });
    });

  // ================== Controls wiring ==================
function applyControls(){
  principal = Math.max(0, Number(c_init.value || 0));
  recurring = Math.max(0, Number(c_rec.value || 0));
  freq      = c_freq.value;
  months    = Math.max(1, Number(c_term.value || 1));
  mode      = c_mode.value;

  c_term_lbl.textContent = months + ' months';
  riskNote.style.display = (mode === 'risk') ? 'block' : 'none';
  modePill.textContent   = (mode === 'risk')
    ? 'High-risk sim • 15% APR ± volatility'
    : 'Safe • 3% APR';

  updateUI();
}

[c_init, c_rec, c_freq, c_term, c_mode].forEach(el =>
  el.addEventListener('input', applyControls)
);

btnSavePlan.addEventListener('click', ()=>{
  const saveObj = { init: principal, save: recurring, freq, term: months, mode };
  localStorage.setItem('lh_plan', JSON.stringify(saveObj));
  openModal('Saved', `<div class="ok">✅ Plan saved. It will auto-load next time.</div>`);
});

// ===== Waitlist (new) =====
(() => {
  const btn = document.getElementById('btnWaitlist');
  if (!btn) return;

  btn.addEventListener('click', () => {
    // Reuse existing modal system
    openModal('Join the LockHabit waitlist', `
      <p class="note">Be first in line when invites open. We’ll only email you about LockHabit.</p>
      <form id="wl-form" class="form" novalidate>
        <input type="email" name="email" placeholder="Email address" required aria-label="Email address"/>
        <input type="text" name="name" placeholder="Name (optional)" aria-label="Name"/>
        <select name="term" aria-label="Preferred lock term">
          <option value="">Preferred lock term (optional)</option>
          <option value="1-3">1–3 months</option>
          <option value="4-6">4–6 months</option>
          <option value="6-12+">6–12+ months</option>
        </select>
        <button class="btn acc" type="submit">Join the waitlist</button>
        <div id="msg" class="note" role="status" aria-live="polite" style="margin-top:6px"></div>
      </form>
      <div id="ok" class="ok" style="display:none;margin-top:10px">✅ Thanks — you’re on the list!</div>
    `);

    const form = document.getElementById('wl-form');
    const msg  = document.getElementById('msg');
    const ok   = document.getElementById('ok');

    form.addEventListener('submit', async (e)=>{
      e.preventDefault();
      msg.textContent = 'Submitting…';
      msg.style.color = '#60708c';

      const data = Object.fromEntries(new FormData(form).entries());

      // 1) Try your Vercel serverless route first
      try{
        const r = await fetch('/api/waitlist', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(data)
        });
        const out = await r.json().catch(()=>({}));
        if (r.ok && out && (out.ok || out.id || out.inserted)) {
          form.style.display = 'none';
          ok.style.display   = 'inline-block';
          return;
        }
      }catch(_){}

      // 2) Fallback to Formspree
      try{
        const fs = await fetch('https://formspree.io/f/manpgypy', {
          method: 'POST',
          headers: { 'Accept': 'application/json' },
          body: new FormData(form)
        });
        if (fs.ok) {
          form.style.display = 'none';
          ok.style.display   = 'inline-block';
          return;
        }
        msg.textContent = 'Network error. Please try again.';
        msg.style.color = '#b42318';
      }catch(_){
        msg.textContent = 'Network error. Please try again.';
        msg.style.color = '#b42318';
      }
    });
  });
})();

// ================== Structured data ==================
  </script>

  <script type="application/ld+json">
  {
    "@context":"https://schema.org",
    "@type":"WebApplication",
    "name":"LockHabit Demo",
    "url":"https://lockhabit.com/demo.html",
    "applicationCategory":"FinanceApplication",
    "operatingSystem":"Any",
    "description":"Interactive savings lock simulator with progress, interest accrual, and 75% vested borrowing power."
  }
  </script>
</body>
</html>
