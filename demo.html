<!doctype html>
<html lang="en">
<head>
  <!-- =========================================================
       LockHabit — Dashboard (static demo, calculator-integrated)
       Clean Tesla vibe • Mobile-first • SoFi/Chase style cards
       Reads plan from localStorage('lh_plan') and/or URL params
       ========================================================= -->
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover"/>
  <title>LockHabit — Dashboard (Preview)</title>
  <meta name="description" content="LockHabit dashboard preview: balances, vaults, emergency line, activity, and insights. Auto-loads from calculator plan."/>
  <meta name="theme-color" content="#0b0e1a"/>

  <link rel="preconnect" href="https://fonts.googleapis.com"/>
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin/>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet"/>

  <link rel="icon" href="/public/favicon.svg" type="image/svg+xml">
  <link rel="alternate icon" href="/public/favicon.ico">
  <link rel="apple-touch-icon" href="/public/icon-192.png">
  <link rel="manifest" href="/public/manifest.webmanifest">

  <style>
    :root{
      --brand:#6f7cff; --brand2:#9c78ff; --ink:#0b1230; --muted:#5c6b86;
      --line:#e8ebf4; --panel:#ffffff; --surface:#f7f8ff; --bg:#0b0e1a;
      --ok:#22c55e; --warn:#f59e0b; --bad:#b42318;
      --shadow:0 18px 50px rgba(17,24,39,.10); --shadow-deep:0 40px 120px rgba(7,10,18,.45);
      --radius:16px; --radius-lg:22px;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; background:#f6f7fb; color:var(--ink);
      font:15.5px/1.6 Inter,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;
      -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale;
    }

    /* Header */
    .hdr{
      position:sticky; top:0; z-index:60; background:rgba(255,255,255,.92);
      backdrop-filter:saturate(1.2) blur(10px); border-bottom:1px solid var(--line);
    }
    .wrap{max-width:1180px; margin:0 auto; padding:12px 16px; display:flex; align-items:center; justify-content:space-between; gap:12px}
    .brand{display:flex; align-items:center; gap:10px; text-decoration:none}
    .logo{width:28px; height:28px; flex:none}
    .word{font-weight:800; font-size:18px; color:#0e1a34}
    .nav{display:flex; align-items:center; gap:10px; flex-wrap:wrap}
    .nav a{color:#19253f; text-decoration:none; font-weight:600}
    .btn{
      appearance:none; border:1px solid var(--line); background:#fff; color:#0f1a34;
      padding:10px 14px; border-radius:12px; font-weight:800; cursor:pointer;
      min-height:40px; -webkit-tap-highlight-color:transparent; touch-action:manipulation;
    }
    .btn.acc{background:linear-gradient(135deg,var(--brand),var(--brand2)); color:#fff; border-color:transparent; box-shadow:0 10px 26px rgba(111,124,255,.25)}
    .btn.ghost{background:transparent}

    /* Preview banner */
    .banner{
      background:#0e1330; color:#e7ebff; border-bottom:1px solid #1a2140;
      font-size:13px;
    }
    .banner .wrap{justify-content:center}
    .badge{display:inline-flex; gap:8px; align-items:center; padding:6px 10px; border-radius:999px; border:1px solid rgba(255,255,255,.2); background:rgba(255,255,255,.06); font-weight:700}

    /* Page layout */
    .page{max-width:1180px; margin:0 auto; padding:16px}
    .grid{
      display:grid; gap:14px;
      grid-template-columns: 1fr;
    }
    @media (min-width:960px){
      .grid{
        grid-template-columns: 1.25fr .75fr;
      }
    }

    /* Cards */
    .card{
      background:#fff; border:1px solid var(--line); border-radius:16px; padding:16px; box-shadow:var(--shadow);
    }
    .row{display:flex; align-items:center; justify-content:space-between; gap:10px}
    .k{font-size:12px; letter-spacing:.04em; text-transform:uppercase; color:var(--muted); font-weight:800}
    .v{font-weight:800; font-size:26px; color:#0b1230}
    .mini{font-size:12.5px; color:#60708c}
    .chip{display:inline-flex; align-items:center; gap:8px; padding:6px 10px; border-radius:999px; background:#f1f4ff; border:1px solid #e3e7ff; color:#3a4a66; font-weight:700}
    .ok{color:var(--ok)} .warn{color:var(--warn)} .bad{color:var(--bad)}

    /* Summary grid */
    .summary{display:grid; grid-template-columns:1fr; gap:12px}
    @media (min-width:680px){ .summary{grid-template-columns:repeat(3,minmax(0,1fr))} }

    .progress{height:10px; background:#eef1f8; border:1px solid #e5e8f1; border-radius:999px; overflow:hidden}
    .fill{height:100%; width:0; background:linear-gradient(90deg,var(--ok),var(--brand)); transition:width .5s ease}

    /* Sub grids */
    .cols2{display:grid; grid-template-columns:1fr; gap:12px}
    @media (min-width:900px){ .cols2{grid-template-columns:1fr 1fr} }

    table{width:100%; border-collapse:collapse}
    th, td{padding:10px 8px; border-bottom:1px solid #eef1f7; text-align:right; font-size:14px}
    th:first-child, td:first-child{text-align:left}
    th{font-size:12px; text-transform:uppercase; letter-spacing:.04em; color:#64718a}
    .muted{color:#66728c}

    /* Vault list */
    .vault{display:flex; align-items:center; gap:12px}
    .pill{border-radius:999px; padding:4px 8px; border:1px solid #e6e9f6; background:#fafbff; font-size:12px; color:#3a4a66; font-weight:700}

    /* Footer */
    footer{color:#3a4a66; font-size:12px; text-align:center; padding:22px 0}
    a.clean{color:#19253f; text-decoration:none; font-weight:700}

    /* Toast */
    .toast{
      position:fixed; left:50%; transform:translateX(-50%);
      bottom:18px; background:#0e1330; color:#e7ebff; border:1px solid #1a2140; border-radius:12px;
      padding:10px 14px; box-shadow:var(--shadow-deep); display:none; z-index:70; font-weight:700
    }
  </style>
</head>
<body>

  <!-- Sticky header -->
  <header class="hdr" role="banner">
    <div class="wrap">
      <a class="brand" href="/" aria-label="Back to home">
        <svg class="logo" viewBox="0 0 120 120" aria-hidden="true">
          <defs><linearGradient id="lg" x1="0" y1="0" x2="1" y2="1"><stop offset="0%" stop-color="#6f7cff"/><stop offset="100%" stop-color="#9c78ff"/></linearGradient></defs>
        <rect x="12" y="22" width="96" height="80" rx="18" fill="url(#lg)"/>
        <path d="M40 50c0-16 12-28 28-28s28 12 28 28" fill="none" stroke="#ffffff" stroke-width="8" stroke-linecap="round"/>
        <path d="M40 90V58" stroke="#ffffff" stroke-width="10" stroke-linecap="round"/>
        <path d="M40 90h26" stroke="#e7ecf8" stroke-width="8" stroke-linecap="round"/>
        </svg>
        <div class="word">LockHabit</div>
      </a>
      <nav class="nav" role="navigation">
        <a href="/index.html">Home</a>
        <a href="/calculator.html">Calculator</a>
        <a class="clean" aria-current="page">Dashboard</a>
        <button id="importBtn" class="btn">Import from Calculator</button>
      </nav>
    </div>
  </header>

  <!-- Preview banner -->
  <div class="banner" role="note" aria-live="polite">
    <div class="wrap">
      <span class="badge">Preview mode — figures below are simulated from your plan</span>
    </div>
  </div>

  <!-- Main page -->
  <main class="page">
    <div class="grid">
      <!-- LEFT COLUMN -->
      <section aria-label="Main">
        <!-- Summary cards -->
        <div class="summary">
          <div class="card">
            <div class="row"><div class="k">Projected balance @ maturity</div><span class="chip" id="aprChip">APR 3.0%</span></div>
            <div class="v" id="sumBalance">$0</div>
            <div class="mini" id="sumTerm">12 months • weekly compounding</div>
          </div>
          <div class="card">
            <div class="k">Projected interest</div>
            <div class="v" id="sumInterest">$0</div>
            <div class="mini">Based on your plan inputs below</div>
          </div>
          <div class="card">
            <div class="k">Emergency line (available)</div>
            <div class="v" id="sumLine">$0</div>
            <div class="mini">Up to <b>80%</b> of vested amount • 0% for 4 months, then 6% APR</div>
          </div>
        </div>

        <!-- Vaults / Goals -->
        <div class="card" style="margin-top:12px">
          <div class="row">
            <div class="k">Vaults</div>
            <span class="pill" id="vaultCount">1 Active</span>
          </div>
          <div class="vault" style="margin-top:10px">
            <div style="flex:1">
              <div class="row" style="align-items:flex-end">
                <div>
                  <div style="font-weight:800">Core Lock</div>
                  <div class="mini" id="vaultLabel">Init $0 • +$0 / bi-weekly • 12 mo</div>
                </div>
                <div class="mini" id="vaultPct">Vested 0%</div>
              </div>
              <div class="progress" style="margin-top:8px"><div class="fill" id="vaultFill" style="width:0%"></div></div>
            </div>
          </div>
        </div>

        <!-- Activity -->
        <div class="card" style="margin-top:12px">
          <div class="row"><div class="k">Recent activity</div><span class="pill" id="activityCount">Scheduled 4</span></div>
          <table style="margin-top:8px" aria-label="Recent activity">
            <thead><tr><th>Date</th><th>Type</th><th>Amount</th></tr></thead>
            <tbody id="activityBody">
              <!-- inserted by JS -->
            </tbody>
          </table>
          <div class="mini" style="margin-top:8px">Activity is simulated from your contribution schedule.</div>
        </div>

        <!-- Insights -->
        <div class="card" style="margin-top:12px">
          <div class="row"><div class="k">Insights</div></div>
          <ul style="margin:8px 0 0; padding-left:18px; color:#33415f">
            <li id="insight1">Locking 25% of your estimated monthly leftover is a good starting discipline.</li>
            <li id="insight2">At maturity, consider stepping up your term to 12+ months for the 3.5% tier.</li>
            <li id="insight3">Emergency line interest (after promo) is credited back to your balance after payoff.</li>
          </ul>
        </div>
      </section>

      <!-- RIGHT COLUMN -->
      <aside aria-label="Plan details & actions">
        <!-- Plan preview (collapsible) -->
        <details class="card" open>
          <summary class="row" style="cursor:pointer"><div class="k">Your LockHabit plan</div><span class="pill">Edit in Calculator</span></summary>
          <div style="margin-top:10px">
            <table>
              <tbody>
                <tr><td>Initial deposit</td><td id="planInit" style="text-align:right">$0</td></tr>
                <tr><td>Recurring deposit</td><td id="planRec" style="text-align:right">$0</td></tr>
                <tr><td>Contribution frequency</td><td id="planFreq" style="text-align:right">—</td></tr>
                <tr><td>Term (months)</td><td id="planTerm" style="text-align:right">—</td></tr>
                <tr><td>APR</td><td id="planApr" style="text-align:right">—</td></tr>
              </tbody>
            </table>
            <div class="row" style="margin-top:12px; gap:8px">
              <a class="btn ghost" href="/calculator.html">Open Calculator</a>
              <button class="btn acc" id="recalcBtn">Recalculate</button>
            </div>
          </div>
        </details>

        <!-- Emergency Line (collapsible) -->
        <details class="card" style="margin-top:12px" open>
          <summary class="row" style="cursor:pointer"><div class="k">Emergency Line</div><span class="pill">80% LTV</span></summary>
          <div style="margin-top:10px">
            <table>
              <tbody>
                <tr><td>Available (preview)</td><td id="lineAvail" style="text-align:right">$0</td></tr>
                <tr><td>Promo</td><td style="text-align:right">0% for 4 months</td></tr>
                <tr><td>After promo</td><td style="text-align:right">6% APR</td></tr>
              </tbody>
            </table>
            <div class="mini" style="margin-top:8px">Interest after promo is credited back to your locked balance after payoff.</div>
          </div>
        </details>

        <!-- LockHabit Projection (collapsible) -->
        <details class="card" style="margin-top:12px" open>
          <summary class="row" style="cursor:pointer"><div class="k">LockHabit projection (compounding)</div></summary>
          <div style="margin-top:10px">
            <table>
              <tbody>
                <tr><td>APR used</td><td id="aprUsed" style="text-align:right">—</td></tr>
                <tr><td>Projected interest</td><td id="projInterest" style="text-align:right">$0</td></tr>
                <tr><td><b>Projected balance @ maturity</b></td><td id="projBalance" style="text-align:right; font-weight:800">$0</td></tr>
              </tbody>
            </table>
          </div>
        </details>

        <!-- Account actions -->
        <div class="card" style="margin-top:12px">
          <div class="k">Account</div>
          <div class="row" style="margin-top:10px; gap:8px; flex-wrap:wrap">
            <a class="btn" href="/#top">Join Waitlist</a>
            <a class="btn ghost" href="/security.html">Security</a>
          </div>
          <div class="mini" style="margin-top:8px">This is a static preview. No money moves here.</div>
        </div>
      </aside>
    </div>
  </main>

  <footer>© <span id="yr"></span> LockHabit — Preview dashboard. <a class="clean" href="/index.html">Home</a> • <a class="clean" href="/calculator.html">Calculator</a></footer>

  <div id="toast" class="toast" role="status" aria-live="polite">Imported from Calculator</div>

  <script>
    // Live year
    document.getElementById('yr').textContent = new Date().getFullYear();

    // ===== Utilities =====
    const $ = (id)=>document.getElementById(id);
    const fmt = (n)=> (isFinite(n)? n : 0).toLocaleString(undefined,{style:'currency',currency:'USD'});
    const clamp = (x,min,max)=>Math.max(min,Math.min(max,x));

    // Simple APR tier helper (mirror of calculator)
    function aprForMonths(m){
      if(m>=24) return 0.035;
      if(m>=12) return 0.030;
      if(m>=6)  return 0.025;
      return 0.020;
    }

    // FV (monthly-compounding baseline) matching calculator’s projection function
    function projectedBalance(init, recurring, freq, months, apr){
      const r = apr/12;
      const n = Math.max(0, Math.floor(months));
      const pmtPerMonth = (freq==='weekly') ? recurring*(52/12)
                         : (freq==='biweekly') ? recurring*(26/12)
                         : recurring;
      const fvLump = init * Math.pow(1+r, n);
      const fvSeries = r ? pmtPerMonth * ((Math.pow(1+r, n) - 1) / r) : pmtPerMonth * n;
      const balance = fvLump + fvSeries;
      const totalContrib = init + pmtPerMonth * n;
      return { balance, interest: Math.max(0, balance - totalContrib) };
    }

    // Build 4 upcoming contribution dates (or recent)
    function buildSchedule(freq, count=4){
      const now = new Date();
      const out = [];
      const stepDays = (freq==='weekly') ? 7 : (freq==='biweekly' ? 14 : 30);
      for(let i=0;i<count;i++){
        const d = new Date(now.getFullYear(), now.getMonth(), now.getDate() + (i*stepDays));
        out.push(d);
      }
      return out;
    }
    function fmtDate(d){
      return d.toLocaleDateString(undefined,{month:'short', day:'numeric'});
    }

    // Read plan from localStorage and/or URL
    function readPlan(){
      let plan = {};
      try{
        const s = localStorage.getItem('lh_plan');
        if(s){ plan = JSON.parse(s) || {}; }
      }catch(_){}

      const q = new URLSearchParams(location.search);
      // URL values override localStorage if present
      if(q.has('init')) plan.init = Number(q.get('init'))||0;
      if(q.has('save')) plan.save = Number(q.get('save'))||0;
      if(q.has('freq')) plan.freq = q.get('freq');
      if(q.has('term')) plan.term = Number(q.get('term'))||12;
      if(q.has('apr'))  plan.apr  = Number(q.get('apr'))/100;

      // sensible defaults
      if(!plan.freq) plan.freq = 'biweekly';
      if(!plan.term) plan.term = 12;

      // derive apr if not supplied
      if(typeof plan.apr !== 'number' || !(plan.apr>0)) plan.apr = aprForMonths(plan.term);

      // normalize types
      plan.init = Number(plan.init)||0;
      plan.save = Number(plan.save)||0;

      return plan;
    }

    function hydrateUI(){
      const plan = readPlan();
      // projection
      const proj = projectedBalance(plan.init, plan.save, plan.freq, plan.term, plan.apr);

      // Summary
      $('sumBalance').textContent = fmt(proj.balance);
      $('sumInterest').textContent = fmt(proj.interest);
      $('aprChip').textContent = 'APR ' + (plan.apr*100).toFixed(1) + '%';
      $('sumTerm').textContent = plan.term + ' months • monthly projection';

      // Vault card
      $('vaultLabel').textContent = `Init ${fmt(plan.init)} • +${fmt(plan.save)} / ${plan.freq.replace('bi','bi-')} • ${plan.term} mo`;

      // Vesting preview — sliderless estimate: assume 10% vested if term > 0 (purely visual)
      const vestedPct = clamp(Math.round((plan.term>0? 10:0)), 0, 100);
      $('vaultPct').textContent = `Vested ${vestedPct}%`;
      $('vaultFill').style.width = vestedPct + '%';

      // Emergency line preview: 80% of vested * projected balance
      const lineAvail = 0.80 * (vestedPct/100) * proj.balance;
      $('sumLine').textContent = fmt(lineAvail);
      $('lineAvail').textContent = fmt(lineAvail);

      // Plan panel
      $('planInit').textContent = fmt(plan.init);
      $('planRec').textContent = fmt(plan.save);
      $('planFreq').textContent = ({weekly:'Weekly',biweekly:'Bi-weekly',monthly:'Monthly'})[plan.freq] || '—';
      $('planTerm').textContent = String(plan.term);
      $('planApr').textContent  = (plan.apr*100).toFixed(2) + '%';

      // Projection panel
      $('aprUsed').textContent = (plan.apr*100).toFixed(2) + '%';
      $('projInterest').textContent = fmt(proj.interest);
      $('projBalance').textContent  = fmt(proj.balance);

      // Activity (next 4 scheduled deposits)
      const tbody = $('activityBody');
      tbody.innerHTML = '';
      const schedule = buildSchedule(plan.freq, 4);
      schedule.forEach(d=>{
        const tr = document.createElement('tr');
        const dt = document.createElement('td'); dt.textContent = fmtDate(d);
        const tp = document.createElement('td'); tp.textContent = 'Scheduled deposit';
        const am = document.createElement('td'); am.textContent = fmt(plan.save);
        tr.append(dt, tp, am); tbody.appendChild(tr);
      });
      $('activityCount').textContent = `Scheduled ${schedule.length}`;
    }

    function toast(msg='Imported from Calculator'){
      const el = $('toast');
      el.textContent = msg;
      el.style.display = 'block';
      setTimeout(()=> el.style.display='none', 2200);
    }

    $('importBtn').addEventListener('click', ()=>{
      // Force re-read/local import
      hydrateUI();
      toast();
    });

    $('recalcBtn').addEventListener('click', ()=>{
      hydrateUI();
      toast('Recalculated from current plan');
    });

    // Auto-import on load
    hydrateUI();
  </script>
</body>
</html>